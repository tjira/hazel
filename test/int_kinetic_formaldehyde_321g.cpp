#include "../include/integral.h"

int test_int_kinetic_formaldehyde_321g(int, char**) {
    // initialize the system
    System system("../example/molecule/formaldehyde.xyz", "3-21G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix T = Integral::Kinetic(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Texp(system.shells.nbf(), system.shells.nbf()); Texp << 30.46994366329924, -2.85420501940650, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.19895785242550, -0.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000029523250, -0.02677353727749, 0.04067094283232, 0.00102893424477, 0.00468287261852, 0.00772554903120, -0.04725335759399, -0.00119546276587, -0.00544077513330, -0.00004899109404, -0.00321101750438, -0.00004899140324, -0.00321101826820, -2.85420501940650, 2.78788218378857, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.65239476933372, 0.00000000000000, 0.00000000000000, -0.00000000000000, -0.01314585826371, -0.08342796870298, 0.03174136476925, 0.00080302483573, 0.00365471655194, 0.04378887037405, -0.20937327558225, -0.00529693481842, -0.02410734325282, -0.00235568154632, -0.01366995796074, -0.00235569133459, -0.01366995572404, 0.00000000000000, 0.00000000000000, 5.35130578087369, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.76116401862445, 0.00000000000000, 0.00000000000000, -0.03352387740884, -0.00885570554730, -0.15853989385542, -0.00361237322260, -0.01644058766435, 0.06176194247055, -0.12125525520205, -0.00461382981083, -0.02099840431734, -0.00396750705873, 0.00064920587605, -0.00443385163216, 0.00072552971512, 0.00000000000000, 0.00000000000000, 0.00000000000000, 5.35130578087369, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.76116401862445, 0.00000000000000, -0.00084812062572, -0.00022404050815, -0.00361237322260, -0.01584409783961, -0.00041593045241, 0.00156251547680, -0.00461382981083, 0.06100003154915, -0.00053123866286, 0.00029150529280, -0.00004769920915, -0.00050405320023, 0.00008248033654, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 5.35130578087369, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.76116401862445, -0.00385995594525, -0.00101965034831, -0.01644058766435, -0.00041593045241, -0.01764568585773, 0.00711130082365, -0.02099840431734, -0.00053123866286, 0.05869899010283, -0.00259611089799, 0.00042480339037, 0.00162878456846, -0.00026652484160, 0.19895785242550, 0.65239476933372, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.56052600000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.01120977439653, 0.03070471512351, -0.16602987251890, -0.00420038999819, -0.01911676223197, 0.09900496752032, -0.29127028696048, -0.00736884743424, -0.03353700594107, -0.02207854116917, -0.01157773797452, -0.02207857131725, -0.01157771015976, -0.00000000000000, 0.00000000000000, 0.76116401862445, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.93421000000000, 0.00000000000000, 0.00000000000000, 0.05135361833629, 0.28780311009022, -0.47776968026352, -0.01509626270691, -0.06870592132729, 0.21086936058260, -0.22455148594007, -0.01095998374340, -0.04988094043157, -0.03466969934133, 0.03198639491796, -0.03874467593206, 0.03574606001333, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.76116401862445, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.93421000000000, 0.00000000000000, 0.00129919526865, 0.00728113132131, -0.01509626270691, 0.11856217447033, -0.00173819120849, 0.00533478427513, -0.01095998374340, 0.20838927300454, -0.00126193798809, 0.00254729247061, -0.00235014160736, -0.00440460789303, 0.00406371647954, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.76116401862445, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.93421000000000, 0.00591288119778, 0.03313779346900, -0.06870592132729, -0.00173819120849, 0.11103326083513, 0.02427960322505, -0.04988094043157, -0.00126193798809, 0.20292323331980, -0.02268587880443, 0.02093007704957, 0.01423293684666, -0.01313138908631, -0.00000029523250, -0.01314585826371, -0.03352387740884, -0.00084812062572, -0.00385995594525, -0.01120977439653, 0.05135361833629, 0.00129919526865, 0.00591288119778, 16.57897377972110, -1.43502704208436, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.10274966905493, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.04281392897379, 0.02064203123130, -0.04281392811838, 0.02064203063681, -0.02677353727749, -0.08342796870298, -0.00885570554730, -0.00022404050815, -0.00101965034831, 0.03070471512351, 0.28780311009022, 0.00728113132131, 0.03313779346900, -1.43502704208436, 1.35736735247949, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.34641224940510, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.02029354199657, 0.10043488874375, -0.02029354549444, 0.10043488663031, 0.04067094283232, 0.03174136476925, -0.15853989385542, -0.00361237322260, -0.01644058766435, -0.16602987251890, -0.47776968026352, -0.01509626270691, -0.06870592132729, 0.00000000000000, 0.00000000000000, 2.58667015032044, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.41750973612682, 0.00000000000000, 0.00000000000000, 0.06584833604430, 0.05782396358137, 0.09261102384761, 0.08132531666026, 0.00102893424477, 0.00080302483573, -0.00361237322260, -0.01584409783961, -0.00041593045241, -0.00420038999819, -0.01509626270691, 0.11856217447033, -0.00173819120849, -0.00000000000000, 0.00000000000000, 0.00000000000000, 2.58667015032044, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.41750973612682, 0.00000000000000, -0.02082423421351, -0.01828656323164, 0.02483311488397, 0.02180691722967, 0.00468287261852, 0.00365471655194, -0.01644058766435, -0.00041593045241, -0.01764568585773, -0.01911676223197, -0.06870592132729, -0.00173819120849, 0.11103326083513, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 2.58667015032044, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.41750973612682, 0.13035665855126, 0.11447120959270, -0.11211165115393, -0.09844957060836, 0.00772554903120, 0.04378887037405, 0.06176194247055, 0.00156251547680, 0.00711130082365, 0.09900496752032, 0.21086936058260, 0.00533478427513, 0.02427960322505, 0.10274966905493, 0.34641224940510, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.29378550000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.08606432471064, 0.13682055550121, 0.08606432261015, 0.13682055380733, -0.04725335759399, -0.20937327558225, -0.12125525520205, -0.00461382981083, -0.02099840431734, -0.29127028696048, -0.22455148594007, -0.01095998374340, -0.04988094043157, 0.00000000000000, 0.00000000000000, 0.41750973612682, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.48964250000000, 0.00000000000000, 0.00000000000000, 0.12928554221979, 0.10425931644612, 0.18183097449670, 0.14663335841778, -0.00119546276587, -0.00529693481842, -0.00461382981083, 0.06100003154915, -0.00053123866286, -0.00736884743424, -0.01095998374340, 0.20838927300454, -0.00126193798809, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.41750973612682, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.48964250000000, 0.00000000000000, -0.04088595966639, -0.03297153056615, 0.04875693293890, 0.03931889405955, -0.00544077513330, -0.02410734325282, -0.02099840431734, -0.00053123866286, 0.05869899010283, -0.03353700594107, -0.04988094043157, -0.00126193798809, 0.20292323331980, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.41750973612682, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.48964250000000, 0.25594012385405, 0.20639695596274, -0.22011818825474, -0.17750919106038, -0.00004899109404, -0.00235568154632, -0.00396750705873, 0.00029150529280, -0.00259611089799, -0.02207854116917, -0.03466969934133, 0.00254729247061, -0.02268587880443, -0.04281392897379, -0.02029354199657, 0.06584833604430, -0.02082423421351, 0.13035665855126, 0.08606432471064, 0.12928554221979, -0.04088595966639, 0.25594012385405, 1.54940494556963, 0.29315085381580, -0.01555850311601, -0.01077204366717, -0.00321101750438, -0.01366995796074, 0.00064920587605, -0.00004769920915, 0.00042480339037, -0.01157773797452, 0.03198639491796, -0.00235014160736, 0.02093007704957, 0.02064203123130, 0.10043488874375, 0.05782396358137, -0.01828656323164, 0.11447120959270, 0.13682055550121, 0.10425931644612, -0.03297153056615, 0.20639695596274, 0.29315085381580, 0.27478737000000, -0.01077204366717, 0.02247031039043, -0.00004899140324, -0.00235569133459, -0.00443385163216, -0.00050405320023, 0.00162878456846, -0.02207857131725, -0.03874467593206, -0.00440460789303, 0.01423293684666, -0.04281392811838, -0.02029354549444, 0.09261102384761, 0.02483311488397, -0.11211165115393, 0.08606432261015, 0.18183097449670, 0.04875693293890, -0.22011818825474, -0.01555850311601, -0.01077204366717, 1.54940494556963, 0.29315085381580, -0.00321101826820, -0.01366995572404, 0.00072552971512, 0.00008248033654, -0.00026652484160, -0.01157771015976, 0.03574606001333, 0.00406371647954, -0.01313138908631, 0.02064203063681, 0.10043488663031, 0.08132531666026, 0.02180691722967, -0.09844957060836, 0.13682055380733, 0.14663335841778, 0.03931889405955, -0.17750919106038, -0.01077204366717, 0.02247031039043, 0.29315085381580, 0.27478737000000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED KINETIC: " << T << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED KINETIC NORM: " << T.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED KINETIC: " << Texp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED KINETIC NORM: " << Texp.norm() << std::endl;

    // return success or failure based on the error
    return (T - Texp).norm() > 1e-8;
}
