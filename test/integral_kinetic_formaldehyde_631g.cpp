#include "../include/integral.h"

int test_integral_kinetic_formaldehyde_631g(int, char**) {
    // initialize the system
    System system("../example/molecule/formaldehyde.xyz", "6-31G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix I = Integral::Kinetic(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Iexp(system.shells.nbf(), system.shells.nbf()); Iexp << 29.54014709713746, -2.18540375982758, 0.00000000000001, 0.00000000000000, 0.00000000000000, 0.13128251236952, -0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00009829450660, -0.02484296668655, 0.01349970829360, 0.00034152914072, 0.00155436313800, 0.01033091751293, -0.04934890256027, -0.00124847796117, -0.00568205722465, -0.00032478787508, -0.00296538333151, -0.00032478938672, -0.00296538251853, -2.18540375982758, 1.71121112543917, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.48004786990615, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.03627091446186, -0.02257137338442, -0.09030403641673, -0.00228460195509, -0.01039765173926, 0.06111110662342, -0.22831684797658, -0.00577618828533, -0.02628851561531, -0.00886527918041, -0.01160693024578, -0.00886530346439, -0.01160691779781, 0.00000000000001, -0.00000000000000, 4.25187686617585, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, -0.05904883336925, 0.10633054049205, -0.31377001136899, -0.00851219042553, -0.03874057421056, 0.07344783105600, -0.11074527519262, -0.00478288450424, -0.02176780391581, -0.01188020855887, 0.00609955805294, -0.01327660044183, 0.00681650788343, 0.00000000000000, 0.00000000000000, 0.00000000000000, 4.25187686617585, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, -0.00149387652551, 0.00269005650615, -0.00851219042553, 0.02247813182068, -0.00098009784606, 0.00185815678995, -0.00478288450424, 0.07818800205374, -0.00055070370448, 0.00087287649983, -0.00044815382301, -0.00150932270543, 0.00077492052015, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 4.25187686617585, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.54724330534162, -0.00679891209015, 0.01224295140233, -0.03874057421056, -0.00098009784606, 0.01823287272547, 0.00845681985687, -0.02176780391581, -0.00055070370448, 0.07580264846930, -0.00777373258661, 0.00399120377097, 0.00487718663484, -0.00250405827086, 0.13128251236952, 0.48004786990615, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.40500873390000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00509236284437, 0.07592627611715, -0.18697016408050, -0.00473015846635, -0.02152783783408, 0.10948228996913, -0.25929014785055, -0.00655978184610, -0.02985479679259, -0.02413207614747, 0.00026944771437, -0.02413208832407, 0.00026948779271, -0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.67501455650000, 0.00000000000000, 0.00000000000000, 0.08674207797036, 0.31696192712010, -0.35793711650856, -0.01304200911869, -0.05935662818379, 0.20496307453396, -0.13937381139513, -0.00905457454146, -0.04120906599039, -0.01647339319259, 0.05422076244896, -0.01840956713703, 0.06059378763951, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.67501455650000, 0.00000000000000, 0.00219448796292, 0.00801882027784, -0.01304200911869, 0.15724771023979, -0.00150166342699, 0.00518536113537, -0.00905457454146, 0.21829956346345, -0.00104254822337, 0.00121035230308, -0.00398377091700, -0.00209285334742, 0.00688847871056, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.67501455650000, 0.00998752606931, 0.03649515418770, -0.05935662818379, -0.00150166342699, 0.15074330830995, 0.02359955050711, -0.04120906599039, -0.00104254822337, 0.21378380277157, -0.01077925129334, 0.03547898219397, 0.00676279256781, -0.02225925322709, -0.00009829450660, -0.03627091446186, -0.05904883336925, -0.00149387652551, -0.00679891209015, 0.00509236284437, 0.08674207797036, 0.00219448796292, 0.00998752606931, 16.20756797345014, -1.24756866124283, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.08995049652200, -0.00000000000000, -0.00000000000000, -0.00000000000000, -0.03472572682435, 0.02337163232553, -0.03472572670191, 0.02337163177617, -0.02484296668655, -0.02257137338442, 0.10633054049205, 0.00269005650615, 0.01224295140233, 0.07592627611715, 0.31696192712010, 0.00801882027784, 0.03649515418770, -1.24756866124283, 0.93224556748206, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.30671845828079, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.03668881118745, 0.11195154190158, 0.03668880712936, 0.11195154001799, 0.01349970829360, -0.09030403641673, -0.31377001136899, -0.00851219042553, -0.03874057421056, -0.18697016408050, -0.35793711650856, -0.01304200911869, -0.05935662818379, 0.00000000000000, 0.00000000000000, 2.17833218887281, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.10092230698444, 0.05871783604191, 0.14194008533100, 0.08258248528813, 0.00034152914072, -0.00228460195509, -0.00851219042553, 0.02247813182068, -0.00098009784606, -0.00473015846635, -0.01304200911869, 0.15724771023979, -0.00150166342699, 0.00000000000000, 0.00000000000000, 0.00000000000000, 2.17833218887281, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, -0.03191621663148, -0.01856924629690, 0.03806041979911, 0.02214401978687, 0.00155436313800, -0.01039765173926, -0.03874057421056, -0.00098009784606, 0.01823287272547, -0.02152783783408, -0.05935662818379, -0.00150166342699, 0.15074330830995, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 2.17833218887281, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.19979084517680, 0.11624076421059, -0.17182767958135, -0.09997145477284, 0.01033091751293, 0.06111110662342, 0.07344783105600, 0.00185815678995, 0.00845681985687, 0.10948228996913, 0.20496307453396, 0.00518536113537, 0.02359955050711, 0.08995049652200, 0.30671845828079, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.25307171730000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.09213131411223, 0.13180697717491, 0.09213131231002, 0.13180697578487, -0.04934890256027, -0.22831684797658, -0.11074527519262, -0.00478288450424, -0.02176780391581, -0.25929014785055, -0.13937381139513, -0.00905457454146, -0.04120906599039, -0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.42178619550000, 0.00000000000000, 0.00000000000000, 0.11951695380328, 0.09218304910193, 0.16809214599640, 0.12964894224606, -0.00124847796117, -0.00577618828533, -0.00478288450424, 0.07818800205374, -0.00055070370448, -0.00655978184610, -0.00905457454146, 0.21829956346345, -0.00104254822337, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.42178619550000, 0.00000000000000, -0.03779668839029, -0.02915246641499, 0.04507294487415, 0.03476462027544, -0.00568205722465, -0.02628851561531, -0.02176780391581, -0.00055070370448, 0.07580264846930, -0.02985479679259, -0.04120906599039, -0.00104254822337, 0.21378380277157, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.42178619550000, 0.23660173778029, 0.18249017329628, -0.20348644524947, -0.15694845366879, -0.00032478787508, -0.00886527918041, -0.01188020855887, 0.00087287649983, -0.00777373258661, -0.02413207614747, -0.01647339319259, 0.00121035230308, -0.01077925129334, -0.03472572682435, 0.03668881118745, 0.10092230698444, -0.03191621663148, 0.19979084517680, 0.09213131411223, 0.11951695380328, -0.03779668839029, 0.23660173778029, 1.39567838062028, 0.25973499598884, -0.02257402858549, -0.00375876931072, -0.00296538333151, -0.01160693024578, 0.00609955805294, -0.00044815382301, 0.00399120377097, 0.00026944771437, 0.05422076244896, -0.00398377091700, 0.03547898219397, 0.02337163232553, 0.11195154190158, 0.05871783604191, -0.01856924629690, 0.11624076421059, 0.13180697717491, 0.09218304910193, -0.02915246641499, 0.18249017329628, 0.25973499598884, 0.24191663820000, -0.00375876931072, 0.03068759695950, -0.00032478938672, -0.00886530346439, -0.01327660044183, -0.00150932270543, 0.00487718663484, -0.02413208832407, -0.01840956713703, -0.00209285334742, 0.00676279256781, -0.03472572670191, 0.03668880712936, 0.14194008533100, 0.03806041979911, -0.17182767958135, 0.09213131231002, 0.16809214599640, 0.04507294487415, -0.20348644524947, -0.02257402858549, -0.00375876931072, 1.39567838062028, 0.25973499598884, -0.00296538251853, -0.01160691779781, 0.00681650788343, 0.00077492052015, -0.00250405827086, 0.00026948779271, 0.06059378763951, 0.00688847871056, -0.02225925322709, 0.02337163177617, 0.11195154001799, 0.08258248528813, 0.02214401978687, -0.09997145477284, 0.13180697578487, 0.12964894224606, 0.03476462027544, -0.15694845366879, -0.00375876931072, 0.03068759695950, 0.25973499598884, 0.24191663820000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL: " << I << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL NORM: " << I.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL: " << Iexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL NORM: " << Iexp.norm() << std::endl;

    // return success or failure based on the error
    return (I - Iexp).norm() > 1e-8;
}
