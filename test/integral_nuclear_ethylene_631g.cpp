#include "../include/integral.h"

int test_integral_nuclear_ethylene_631g(int, char**) {
    // initialize the system
    System system("../example/molecule/ethylene.xyz", "6-31G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix I = Integral::Nuclear(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Iexp(system.shells.nbf(), system.shells.nbf()); Iexp << -38.06776932486537, -3.27048906270018, -0.07748203716957, -0.00107591834362, -0.02051396865749, -3.97427179902030, -0.01301652161857, -0.00018074788519, -0.00344622478569, -0.00009763008922, -0.46927202071822, 1.00085951427302, 0.01388555066630, 0.26510983520101, -1.46039397447748, 2.79236153939707, 0.03874017189225, 0.73964680156746, -0.68000733242369, -1.98596377618504, -0.68000310250278, -1.98596046599338, -0.00091692342835, -0.32747517551929, -0.00091684133529, -0.32746704070749, -3.27048906270018, -9.63235109831167, -0.56173340319067, -0.00780011267950, -0.14872492329477, -7.29614475926570, -0.40814789557773, -0.00566711862880, -0.10806527782293, -0.46927202340687, -2.22965262513812, 2.98040308358264, 0.04134847724449, 0.78946272665779, -3.50887155602324, 5.08191473081107, 0.07050338783343, 1.34612392547269, -2.26052947170195, -4.09206204935701, -2.26051784096990, -4.09205235046874, -0.08627614486856, -1.08029432098188, -0.08627252083691, -1.08027388054348, -0.07748203716957, -0.56173340319067, -10.38617717712803, 0.00190728543743, -0.11711054436572, -0.56413278131434, -4.81305345101680, 0.00086854477026, -0.11440460239592, -1.00085961554399, -2.98040686228925, 3.30571953401981, 0.06228141774349, 1.17968924662620, -2.49559466361032, 1.45541032828256, 0.04989421041274, 0.91518779234955, 1.32482997740430, 0.70432540492710, 1.57943011473709, 0.88094974370792, -0.16459318833049, -1.02498886399603, -0.15755902678230, -0.98291221436141, -0.00107591834362, -0.00780011267950, 0.00190728543743, -10.09537148645567, -0.02404048275037, -0.00783305578416, 0.00086854477026, -4.51025830437526, -0.02071248940143, -0.01388558657942, -0.04134965634456, 0.06228291908346, -1.15632789633344, 0.01498743240594, -0.03462481510491, 0.04989779192433, -2.03585159620667, 0.00723054274577, 2.47167902199602, 1.71164626607411, -2.43149566986165, -1.68973894103647, 0.06546002987397, 0.39121313161906, -0.06992970293281, -0.41908241065598, -0.02051396865749, -0.14872492329477, -0.11711054436572, -0.02404048275037, -9.97385950230331, -0.14936433047237, -0.11440460239592, -0.02071248940143, -4.41040944002835, -0.26510947774842, -0.78944837083519, 1.17966908385694, 0.01498675499700, -0.83532869592977, -0.66101521830050, 0.91514307339764, 0.00722897365318, -1.75692780035867, 0.73727360245810, 0.45460252489493, 0.03311744640005, -0.03387676187030, -0.03292941193795, -0.20764857941484, -0.05237202140962, -0.32401669644536, -3.97427179902030, -7.29614475926570, -0.56413278131434, -0.00783305578416, -0.14936433047237, -7.65257322688459, -0.82901560850669, -0.01150937578234, -0.21951356940859, -1.46039398965435, -3.50887155963181, 2.49558336190910, 0.03462081097491, 0.66105783175171, -4.82169300719764, 4.72435906669767, 0.06554080919414, 1.25143743757527, -2.65194827603916, -4.81216052805960, -2.65193767341286, -4.81214721331071, -0.59918407910319, -2.06636578086858, -0.59917194420261, -2.06633965226090, -0.01301652161857, -0.40814789557773, -4.81305345101680, 0.00086854477026, -0.11440460239592, -0.82901560850669, -6.60037116021072, -0.00156701924055, -0.25002519791394, -2.79236185154916, -5.08192281679971, 1.45539326676907, 0.04989020293027, 0.91521748412489, -4.72437880470251, 0.29384836015334, 0.05830143555730, 1.01417260625231, 1.48534467025883, 1.11496354905069, 1.76915278040385, 1.38866004002799, -1.36124027405897, -2.83378560446259, -1.29921876226584, -2.72027450410922, -0.00018074788519, -0.00566711862880, 0.00086854477026, -4.51025830437526, -0.02071248940143, -0.01150937578234, -0.00156701924055, -5.87345039131402, -0.03560992974893, -0.03874028945231, -0.07050618249759, 0.04989416077317, -2.03585159249905, 0.00723007151423, -0.06554759934947, 0.05830782034519, -3.63162076581345, -0.00039947668957, 2.75532301856181, 2.65267586282830, -2.71029720988439, -2.61807251393058, 0.57872836771316, 1.05459782678070, -0.61565536998074, -1.13169385910687, -0.00344622478569, -0.10806527782293, -0.11440460239592, -0.02071248940143, -4.41040944002835, -0.21951356940859, -0.25002519791394, -0.03560992974893, -5.72090568536971, -0.73964575031242, -1.34609343929212, 0.91517283006381, 0.00722840363852, -1.75691087959976, -1.25136289248697, 1.01409444311720, -0.00040225231215, -3.26532033178931, 0.82410762188914, 0.71067498526394, 0.03917807492611, -0.04626667484150, -0.26645499915833, -0.57833762872671, -0.43798274178664, -0.89231985783031, -0.00009763008922, -0.46927202340687, -1.00085961554399, -0.01388558657942, -0.26510947774842, -1.46039398965435, -2.79236185154916, -0.03874028945231, -0.73964575031242, -38.06776961967721, -3.27048912728135, 0.07747722049422, 0.00107380782294, 0.02053192404124, -3.97427185334270, 0.01301571244845, 0.00018039333153, 0.00344924117323, -0.00091695319915, -0.32747812704417, -0.00091683659619, -0.32746657611420, -0.68000277993427, -1.98596024586808, -0.68000700707393, -1.98596352924379, -0.46927202071822, -2.22965262513812, -2.98040686228925, -0.04134965634456, -0.78944837083519, -3.50887155963181, -5.08192281679971, -0.07050618249759, -1.34609343929212, -3.27048912728135, -9.63235139655934, 0.56169931078563, 0.00778519169248, 0.14885201189358, -7.29614500827475, 0.40812500549233, 0.00565714595035, 0.10815062524865, -0.08627754653098, -1.08030174251372, -0.08627224204864, -1.08027261290660, -2.26052029083468, -4.09205551943380, -2.26052546642466, -4.09205778885409, 1.00085951427302, 2.98040308358264, 3.30571953401981, 0.06228291908346, 1.17966908385694, 2.49558336190910, 1.45539326676907, 0.04989416077317, 0.91517283006381, 0.07747722049422, 0.56169931078563, -10.38619514105870, 0.00189951947501, -0.11708013072684, 0.56410061814949, -4.81306784438850, 0.00086210291144, -0.11438016448466, 0.15755903380559, 0.98287981414892, 0.16457956780051, 1.02492998831944, -1.57965478885027, -0.88111611432250, -1.32516058548952, -0.70456987034400, 0.01388555066630, 0.04134847724449, 0.06228141774349, -1.15632789633344, 0.01498675499700, 0.03462081097491, 0.04989020293027, -2.03585159249905, 0.00722840363852, 0.00107380782294, 0.00778519169248, 0.00189951947501, -10.09537148822313, -0.02404199782575, 0.00781902966153, 0.00086210291144, -4.51025824306893, -0.02071376132692, 0.06993071755181, 0.41907307236095, -0.06546037085846, -0.39122655328260, 2.43136833222629, 1.68964468094408, -2.47179806917411, -1.71173551971508, 0.26510983520101, 0.78946272665779, 1.17968924662620, 0.01498743240594, -0.83532869592977, 0.66105783175171, 0.91521748412489, 0.00723007151423, -1.75691087959976, 0.02053192404124, 0.14885201189358, -0.11708013072684, -0.02404199782575, -9.97384243755808, 0.14948424879373, -0.11438016448466, -0.02071376132692, -4.41039565505408, 0.05240309569924, 0.32420014288547, 0.03295671534091, 0.20782455985465, -0.03207412973683, 0.03464692681518, -0.73625762554708, -0.45385265437235, -1.46039397447748, -3.50887155602324, -2.49559466361032, -0.03462481510491, -0.66101521830050, -4.82169300719764, -4.72437880470251, -0.06554759934947, -1.25136289248697, -3.97427185334270, -7.29614500827475, 0.56410061814949, 0.00781902966153, 0.14948424879373, -7.65257355559754, 0.82897675137467, 0.01149273744481, 0.21965866199559, -0.59918899800663, -2.06637549890317, -0.59917078088340, -2.06633770421448, -2.65194179121747, -4.81215408817195, -2.65194284805850, -4.81215219222162, 2.79236153939707, 5.08191473081107, 1.45541032828256, 0.04989779192433, 0.91514307339764, 4.72435906669767, 0.29384836015334, 0.05830782034519, 1.01409444311720, 0.01301571244845, 0.40812500549233, -4.81306784438850, 0.00086210291144, -0.11438016448466, 0.82897675137467, -6.60038720662544, -0.00157597074795, -0.24999846425288, 1.29917498627453, 2.72016446406665, 1.36115569450475, 2.83364609660414, -1.76940360608955, -1.38891257066085, -1.48571193216643, -1.11533841341162, 0.03874017189225, 0.07050338783343, 0.04989421041274, -2.03585159620667, 0.00722897365318, 0.06554080919414, 0.05830143555730, -3.63162076581345, -0.00040225231215, 0.00018039333153, 0.00565714595035, 0.00086210291144, -4.51025824306893, -0.02071376132692, 0.01149273744481, -0.00157597074795, -5.87345038537464, -0.03561182164153, 0.61564387098896, 1.13165824182179, -0.57874626473813, -1.05464163207595, 2.71015743619200, 2.61793054603256, -2.75545428492204, -2.65281009335794, 0.73964680156746, 1.34612392547269, 0.91518779234955, 0.00723054274577, -1.75692780035867, 1.25143743757527, 1.01417260625231, -0.00039947668957, -3.26532033178931, 0.00344924117323, 0.10815062524865, -0.11438016448466, -0.02071376132692, -4.41039565505408, 0.21965866199559, -0.24999846425288, -0.03561182164153, -5.72089066351383, 0.43824189991480, 0.89280459151810, 0.26670263006601, 0.57881369138232, -0.03801785396906, 0.04744245281722, -0.82297756137775, -0.70953100296992, -0.68000733242369, -2.26052947170195, 1.32482997740430, 2.47167902199602, 0.73727360245810, -2.65194827603916, 1.48534467025883, 2.75532301856181, 0.82410762188914, -0.00091695319915, -0.08627754653098, 0.15755903380559, 0.06993071755181, 0.05240309569924, -0.59918899800663, 1.29917498627453, 0.61564387098896, 0.43824189991480, -6.77946226299092, -4.10170304116528, -0.12279924070407, -0.96671866345004, -0.00465014055526, -0.26759983657801, -0.00015240023755, -0.06811879175161, -1.98596377618504, -4.09206204935701, 0.70432540492710, 1.71164626607411, 0.45460252489493, -4.81216052805960, 1.11496354905069, 2.65267586282830, 0.71067498526394, -0.32747812704417, -1.08030174251372, 0.98287981414892, 0.41907307236095, 0.32420014288547, -2.06637549890317, 2.72016446406665, 1.13165824182179, 0.89280459151810, -4.10170304116528, -5.47020925573653, -0.96671669922245, -2.45691048663639, -0.26759971860392, -1.12952414884451, -0.06811892264524, -0.53095346948541, -0.68000310250278, -2.26051784096990, 1.57943011473709, -2.43149566986165, 0.03311744640005, -2.65193767341286, 1.76915278040385, -2.71029720988439, 0.03917807492611, -0.00091683659619, -0.08627224204864, 0.16457956780051, -0.06546037085846, 0.03295671534091, -0.59917078088340, 1.36115569450475, -0.57874626473813, 0.26670263006601, -0.12279924070407, -0.96671669922245, -6.77944409515866, -4.10169123016430, -0.00015239598426, -0.06811810605350, -0.00464909283567, -0.26757542747608, -1.98596046599338, -4.09205235046874, 0.88094974370792, -1.68973894103647, -0.03387676187030, -4.81214721331071, 1.38866004002799, -2.61807251393058, -0.04626667484150, -0.32746657611420, -1.08027261290660, 1.02492998831944, -0.39122655328260, 0.20782455985465, -2.06633770421448, 2.83364609660414, -1.05464163207595, 0.57881369138232, -0.96671866345004, -2.45691048663639, -4.10169123016430, -5.47019281636517, -0.06811800753775, -0.53094973697309, -0.26757557203821, -1.12946284437150, -0.00091692342835, -0.08627614486856, -0.16459318833049, 0.06546002987397, -0.03292941193795, -0.59918407910319, -1.36124027405897, 0.57872836771316, -0.26645499915833, -0.68000277993427, -2.26052029083468, -1.57965478885027, 2.43136833222629, -0.03207412973683, -2.65194179121747, -1.76940360608955, 2.71015743619200, -0.03801785396906, -0.00465014055526, -0.26759971860392, -0.00015239598426, -0.06811800753775, -6.77945580581405, -4.10169895681795, -0.12280053735006, -0.96672207592571, -0.32747517551929, -1.08029432098188, -1.02498886399603, 0.39121313161906, -0.20764857941484, -2.06636578086858, -2.83378560446259, 1.05459782678070, -0.57833762872671, -1.98596024586808, -4.09205551943380, -0.88111611432250, 1.68964468094408, 0.03464692681518, -4.81215408817195, -1.38891257066085, 2.61793054603256, 0.04744245281722, -0.26759983657801, -1.12952414884451, -0.06811810605350, -0.53094973697309, -4.10169895681795, -5.47020453082655, -0.96672153549917, -2.45691613516020, -0.00091684133529, -0.08627252083691, -0.15755902678230, -0.06992970293281, -0.05237202140962, -0.59917194420261, -1.29921876226584, -0.61565536998074, -0.43798274178664, -0.68000700707393, -2.26052546642466, -1.32516058548952, -2.47179806917411, -0.73625762554708, -2.65194284805850, -1.48571193216643, -2.75545428492204, -0.82297756137775, -0.00015240023755, -0.06811892264524, -0.00464909283567, -0.26757557203821, -0.12280053735006, -0.96672153549917, -6.77944857282557, -4.10169403505710, -0.32746704070749, -1.08027388054348, -0.98291221436141, -0.41908241065598, -0.32401669644536, -2.06633965226090, -2.72027450410922, -1.13169385910687, -0.89231985783031, -1.98596352924379, -4.09205778885409, -0.70456987034400, -1.71173551971508, -0.45385265437235, -4.81215219222162, -1.11533841341162, -2.65281009335794, -0.70953100296992, -0.06811879175161, -0.53095346948541, -0.26757542747608, -1.12946284437150, -0.96672207592571, -2.45691613516020, -4.10169403505710, -5.47019579944829;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL: " << I << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL NORM: " << I.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL: " << Iexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL NORM: " << Iexp.norm() << std::endl;

    // return success or failure based on the error
    return (I - Iexp).norm() > 1e-8;
}
