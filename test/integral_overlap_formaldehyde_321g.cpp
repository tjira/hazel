#include "../include/integral.h"

int test_integral_overlap_formaldehyde_321g(int, char**) {
    // initialize the system
    System system("../example/molecule/formaldehyde.xyz", "3-21G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix I = Integral::Overlap(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Iexp(system.shells.nbf(), system.shells.nbf()); Iexp << 1.00000000000000, 0.20921460986922, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.18308745823386, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000231931, 0.00798125303095, -0.02124129850228, -0.00053738364322, -0.00244573369121, 0.04164048919532, -0.08278051534794, -0.00209426438410, -0.00953138977545, 0.00000323369216, 0.00761718990913, 0.00000323371486, 0.00761720246630, 0.20921460986922, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.74001611059698, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00104436004584, 0.08089966630676, -0.15489211211541, -0.00391861578074, -0.01783435495068, 0.21519199917718, -0.38234928508533, -0.00967305514677, -0.04402388715746, 0.00033715775436, 0.04655733210295, 0.00033715941721, 0.04655740128298, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.49876667737339, 0.00000000000000, 0.00000000000000, 0.00329491761051, 0.11571893202762, -0.19275186957991, -0.00595376316321, -0.02709669217042, 0.11208584721865, -0.09145807647409, -0.00511983579567, -0.02330133240361, 0.00066170889431, 0.03145204663858, 0.00073948744663, 0.03514886016093, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.49876667737339, -0.00000000000000, 0.00008335812566, 0.00292757343793, -0.00595376316321, 0.04243340101945, -0.00068551925656, 0.00283566001981, -0.00511983579567, 0.11078543473397, -0.00058950044403, -0.00004861784545, -0.00231088134913, 0.00008406709221, 0.00399582505652, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.49876667737339, 0.00037937845508, 0.01332393548069, -0.02709669217042, -0.00068551925656, 0.03946409864770, 0.01290562028591, -0.02330133240361, -0.00058950044403, 0.10823203444674, 0.00043298465419, 0.02058042993594, -0.00027165224314, -0.01291200648522, 0.18308745823386, 0.74001611059698, 0.00000000000000, 0.00000000000000, -0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.04354841104215, 0.26290464824506, -0.28464156004083, -0.00720114726178, -0.03277377102134, 0.46940900722719, -0.62247450752452, -0.01574798351564, -0.07167202489090, 0.01827550220977, 0.14778799135372, 0.01827554541803, 0.14778815739560, 0.00000000000000, 0.00000000000000, 0.49876667737339, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.11473329754227, 0.47525848448153, -0.34039073989408, -0.01377046050526, -0.06267194699002, 0.45064947321068, -0.15165600014064, -0.01511862867178, -0.06880771302583, 0.04968860134048, 0.19094485893987, 0.05552895266410, 0.21338807169727, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.49876667737339, -0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00290263786958, 0.01202356512405, -0.01377046050526, 0.20356933903866, -0.00158553768253, 0.01140098171036, -0.01511862867178, 0.44555935387851, -0.00174076643683, -0.00365077870517, -0.01402932274351, 0.00631269348142, 0.02425857907612, -0.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.49876667737339, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.01321044903504, 0.05472149865998, -0.06267194699002, -0.00158553768253, 0.19670163874265, 0.05188800484292, -0.06880771302583, -0.00174076643683, 0.43801928573301, 0.03251339381038, 0.12494345236723, -0.02039867562230, -0.07838854952933, 0.00000000231931, 0.00104436004584, 0.00329491761051, 0.00008335812566, 0.00037937845508, 0.04354841104215, 0.11473329754227, 0.00290263786958, 0.01321044903504, 1.00000000000000, 0.19144744450067, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.18031400188717, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.01774795728184, 0.07955245106880, 0.01774795640090, 0.07955245010293, 0.00798125303095, 0.08089966630676, 0.11571893202762, 0.00292757343793, 0.01332393548069, 0.26290464824506, 0.47525848448153, 0.01202356512405, 0.05472149865998, 0.19144744450067, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.76135740608460, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.18796234159350, 0.39616015278038, 0.18796233663192, 0.39616014887420, -0.02124129850228, -0.15489211211541, -0.19275186957991, -0.00595376316321, -0.02709669217042, -0.28464156004083, -0.34039073989408, -0.01377046050526, -0.06267194699002, -0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.12749383948086, 0.10453373450119, 0.17931106915785, 0.14701930791937, -0.00053738364322, -0.00391861578074, -0.00595376316321, 0.04243340101945, -0.00068551925656, -0.00720114726178, -0.01377046050526, 0.20356933903866, -0.00158553768253, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, -0.04031934189413, -0.03305831401726, 0.04808123477494, 0.03942238420483, -0.00244573369121, -0.01783435495068, -0.02709669217042, -0.00068551925656, 0.03946409864770, -0.03277377102134, -0.06267194699002, -0.00158553768253, 0.19670163874265, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.25239317952418, 0.20694020766590, -0.21706767940004, -0.17797640796489, 0.04164048919532, 0.21519199917718, 0.11208584721865, 0.00283566001981, 0.01290562028591, 0.46940900722719, 0.45064947321068, 0.01140098171036, 0.05188800484292, 0.18031400188717, 0.76135740608460, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.33387300706178, 0.66307035219304, 0.33387300342543, 0.66307034791184, -0.08278051534794, -0.38234928508533, -0.09145807647409, -0.00511983579567, -0.02330133240361, -0.62247450752452, -0.15165600014064, -0.01511862867178, -0.06880771302583, -0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.22381876485148, 0.26350958324112, 0.31478527043017, 0.37060760229763, -0.00209426438410, -0.00967305514677, -0.00511983579567, 0.11078543473397, -0.00058950044403, -0.01574798351564, -0.01511862867178, 0.44555935387851, -0.00174076643683, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, -0.07078165767942, -0.08333369692481, 0.08440786484811, 0.09937630297527, -0.00953138977545, -0.04402388715746, -0.02330133240361, -0.00058950044403, 0.10823203444674, -0.07167202489090, -0.06880771302583, -0.00174076643683, 0.43801928573301, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.44308281818212, 0.52165674686815, -0.38106798694865, -0.44864454033198, 0.00000323369216, 0.00033715775436, 0.00066170889431, -0.00004861784545, 0.00043298465419, 0.01827550220977, 0.04968860134048, -0.00365077870517, 0.03251339381038, 0.01774795728184, 0.18796234159350, 0.12749383948086, -0.04031934189413, 0.25239317952418, 0.33387300706178, 0.22381876485148, -0.07078165767942, 0.44308281818212, 1.00000000000000, 0.64589812339497, 0.00524683558119, 0.10132512185751, 0.00761718990913, 0.04655733210295, 0.03145204663858, -0.00231088134913, 0.02058042993594, 0.14778799135372, 0.19094485893987, -0.01402932274351, 0.12494345236723, 0.07955245106880, 0.39616015278038, 0.10453373450119, -0.03305831401726, 0.20694020766590, 0.66307035219304, 0.26350958324112, -0.08333369692481, 0.52165674686815, 0.64589812339497, 1.00000000000000, 0.10132512185751, 0.32531778643009, 0.00000323371486, 0.00033715941721, 0.00073948744663, 0.00008406709221, -0.00027165224314, 0.01827554541803, 0.05552895266410, 0.00631269348142, -0.02039867562230, 0.01774795640090, 0.18796233663192, 0.17931106915785, 0.04808123477494, -0.21706767940004, 0.33387300342543, 0.31478527043017, 0.08440786484811, -0.38106798694865, 0.00524683558119, 0.10132512185751, 1.00000000000000, 0.64589812339497, 0.00761720246630, 0.04655740128298, 0.03514886016093, 0.00399582505652, -0.01291200648522, 0.14778815739560, 0.21338807169727, 0.02425857907612, -0.07838854952933, 0.07955245010293, 0.39616014887420, 0.14701930791937, 0.03942238420483, -0.17797640796489, 0.66307034791184, 0.37060760229763, 0.09937630297527, -0.44864454033198, 0.10132512185751, 0.32531778643009, 0.64589812339497, 1.00000000000000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL: " << I << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL NORM: " << I.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL: " << Iexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL NORM: " << Iexp.norm() << std::endl;

    // return success or failure based on the error
    return (I - Iexp).norm() > 1e-8;
}
