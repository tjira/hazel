#include "../include/integral.h"

int test_int_overlap_water_ccpvdz(int, char**) {
    // initialize the system
    System system("../example/molecule/water.xyz", "CC-PVDZ", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix S = Integral::Overlap(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Sexp(system.shells.nbf(), system.shells.nbf()); Sexp << 1.00000000000000, 0.00000113818663, 0.19189620099354, -0.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.06131101307745, 0.06628414466962, -0.06911957423621, 0.04981673868826, -0.04893862050446, 0.06131083100461, 0.06628405492647, -0.04249666755275, -0.08848543721981, 0.00429658784256, 0.00000113818663, 1.00000000000000, 0.93332372028985, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.50077059240487, 0.52572692992995, -0.29286775241759, 0.21107937156190, -0.20735868170398, 0.50076969054264, 0.52572637769629, -0.18006410953184, -0.37492472650342, 0.01820522192561, 0.19189620099354, 0.93332372028985, 1.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.59862486889228, 0.63557838433892, -0.27149301920358, 0.19567390197069, -0.19222476387095, 0.59862395841234, 0.63557776148666, -0.16692241230167, -0.34756143210444, 0.01687654229491, -0.00000000000000, -0.00000000000000, -0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.80456377931676, 0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.28394288943660, 0.18038900939027, -0.01367697180301, 0.22190128611042, -0.21798983868389, 0.17457699655684, 0.11090896548481, 0.17781969628124, -0.24233426343729, 0.01176702611001, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.80456377931676, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, -0.20464693079724, -0.13001226124917, 0.22190128611042, 0.13427441975098, 0.15711240918961, 0.36349960499091, 0.23093171459478, -0.24233426343729, -0.21037706021021, 0.02450099055012, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.80456377931676, -0.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.20103962538299, 0.12772053895411, -0.21798983868389, 0.15711240918961, 0.13986294369429, -0.01765045223997, -0.01121335248563, 0.01176702611001, 0.02450099055012, 0.29301523909677, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.80456377931676, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.39545098896834, 0.27947156465090, 0.11580056809331, 0.18654122415331, -0.18325306749614, 0.24313583712199, 0.17182812182233, 0.27678198986121, -0.20371855797140, 0.00989196309569, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.80456377931676, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.28501446658405, -0.20142430072608, 0.18654122415331, 0.24017584405242, 0.13207648163572, 0.50625100956071, 0.35777597072138, -0.20371855797140, -0.04955602903836, 0.02059678393366, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.80456377931676, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.27999052498647, 0.19787380051706, -0.18325306749614, 0.13207648163572, 0.24487383438799, -0.02458203294584, -0.01737252970050, 0.00989196309569, 0.02059678393366, 0.37362124624307, 0.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.08865131666481, -0.01552432021996, 0.08432305835628, 0.03981250300348, 0.16651825908764, 0.09681438363327, 0.01695386807397, 0.11005120318730, -0.20011065442789, 0.01596583312668, 0.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.06276764854850, -0.01099165937044, 0.16651825908764, 0.02818838219636, -0.03296313986027, -0.00978833230130, -0.00171410577925, 0.01596583312668, 0.02023201004915, 0.26635176684158, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.01835196412287, -0.00321373419400, -0.07216367426158, 0.05201072117702, 0.20560213117526, -0.07134044579750, -0.01249294227778, 0.04206174166776, 0.08757984604508, -0.02678941136423, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.08708866252023, 0.01525067348524, -0.08283669829327, 0.16651825908764, 0.04573559515585, -0.00470101653757, -0.00082322906164, -0.00534375685458, 0.01596583312668, 0.12792006055680, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.02955387481875, 0.00517537509523, 0.13091424243427, 0.20737140983345, -0.05551254024482, -0.07754378018006, -0.01357925310055, 0.25517764136130, -0.00460782058514, -0.01278788345187, 0.06131101307745, 0.50077059240487, 0.59862486889228, 0.28394288943660, -0.20464693079724, 0.20103962538299, 0.39545098896834, -0.28501446658405, 0.27999052498647, -0.08865131666481, -0.06276764854850, -0.01835196412287, 0.08708866252023, 0.02955387481875, 1.00000000000000, 0.90368690205096, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.37463572134441, 0.48411543469034, 0.03202823867773, -0.16638484855400, 0.06404451285110, 0.06628414466962, 0.52572692992995, 0.63557838433892, 0.18038900939027, -0.13001226124917, 0.12772053895411, 0.27947156465090, -0.20142430072608, 0.19787380051706, -0.01552432021996, -0.01099165937044, -0.00321373419400, 0.01525067348524, 0.00517537509523, 0.90368690205096, 1.00000000000000, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.48411543469034, 0.60607549450650, 0.03094385836329, -0.16075155550254, 0.06187615730452, -0.06911957423621, -0.29286775241759, -0.27149301920358, -0.01367697180301, 0.22190128611042, -0.21798983868389, 0.11580056809331, 0.18654122415331, -0.18325306749614, 0.08432305835628, 0.16651825908764, -0.07216367426158, -0.08283669829327, 0.13091424243427, -0.00000000000000, -0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.03202823867773, -0.03094385836329, 0.04115167854218, 0.04903668230298, -0.01887509864764, 0.04981673868826, 0.21107937156190, 0.19567390197069, 0.22190128611042, 0.13427441975098, 0.15711240918961, 0.18654122415331, 0.24017584405242, 0.13207648163572, 0.03981250300348, 0.02818838219636, 0.05201072117702, 0.16651825908764, 0.20737140983345, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.16638484855400, 0.16075155550254, 0.04903668230298, -0.20415173907633, 0.09805504640854, -0.04893862050446, -0.20735868170398, -0.19222476387095, -0.21798983868389, 0.15711240918961, 0.13986294369429, -0.18325306749614, 0.13207648163572, 0.24487383438799, 0.16651825908764, -0.03296313986027, 0.20560213117526, 0.04573559515585, -0.05551254024482, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, -0.06404451285110, -0.06187615730452, -0.01887509864764, 0.09805504640854, 0.01284784465352, 0.06131083100461, 0.50076969054264, 0.59862395841234, 0.17457699655684, 0.36349960499091, -0.01765045223997, 0.24313583712199, 0.50625100956071, -0.02458203294584, 0.09681438363327, -0.00978833230130, -0.07134044579750, -0.00470101653757, -0.07754378018006, 0.37463572134441, 0.48411543469034, -0.03202823867773, 0.16638484855400, -0.06404451285110, 1.00000000000000, 0.90368690205096, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.06628405492647, 0.52572637769629, 0.63557776148666, 0.11090896548481, 0.23093171459478, -0.01121335248563, 0.17182812182233, 0.35777597072138, -0.01737252970050, 0.01695386807397, -0.00171410577925, -0.01249294227778, -0.00082322906164, -0.01357925310055, 0.48411543469034, 0.60607549450650, -0.03094385836329, 0.16075155550254, -0.06187615730452, 0.90368690205096, 1.00000000000000, -0.00000000000000, -0.00000000000000, 0.00000000000000, -0.04249666755275, -0.18006410953184, -0.16692241230167, 0.17781969628124, -0.24233426343729, 0.01176702611001, 0.27678198986121, -0.20371855797140, 0.00989196309569, 0.11005120318730, 0.01596583312668, 0.04206174166776, -0.00534375685458, 0.25517764136130, 0.03202823867773, 0.03094385836329, 0.04115167854218, 0.04903668230298, -0.01887509864764, -0.00000000000000, -0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.08848543721981, -0.37492472650342, -0.34756143210444, -0.24233426343729, -0.21037706021021, 0.02450099055012, -0.20371855797140, -0.04955602903836, 0.02059678393366, -0.20011065442789, 0.02023201004915, 0.08757984604508, 0.01596583312668, -0.00460782058514, -0.16638484855400, -0.16075155550254, 0.04903668230298, -0.20415173907633, 0.09805504640854, -0.00000000000000, -0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00429658784256, 0.01820522192561, 0.01687654229491, 0.01176702611001, 0.02450099055012, 0.29301523909677, 0.00989196309569, 0.02059678393366, 0.37362124624307, 0.01596583312668, 0.26635176684158, -0.02678941136423, 0.12792006055680, -0.01278788345187, 0.06404451285110, 0.06187615730452, -0.01887509864764, 0.09805504640854, 0.01284784465352, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED OVERLAP: " << S << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED OVERLAP NORM: " << S.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED OVERLAP: " << Sexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED OVERLAP NORM: " << Sexp.norm() << std::endl;

    // return success or failure based on the error
    return (S - Sexp).norm() > 1e-8;
}
