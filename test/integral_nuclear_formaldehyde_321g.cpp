#include "../include/integral.h"

int test_integral_nuclear_formaldehyde_321g(int, char**) {
    // initialize the system
    System system("../example/molecule/formaldehyde.xyz", "3-21G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix I = Integral::Nuclear(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Iexp(system.shells.nbf(), system.shells.nbf()); Iexp << -65.37335717322372, -5.27498828701798, -0.08090939637086, -0.00204692757911, -0.00931594490487, -6.99694275966503, -0.01144764484248, -0.00028961407445, -0.00131808706314, -0.00000003401272, -0.28482632174510, 0.77515940642681, 0.01961075900156, 0.08925224023537, -1.56996089260008, 3.13868342338491, 0.07940555670168, 0.36138957302908, -0.00009672012812, -0.28451447736296, -0.00009672082104, -0.28451494884870, -5.27498828701798, -14.98885028261067, -0.53021816703835, -0.01341399439047, -0.06104956226654, -10.22182227543558, -0.32232590229252, -0.00815452603136, -0.03711275181539, -0.01829450884991, -1.06709830173419, 2.10692583467531, 0.05330311951094, 0.24259249224537, -2.90349820266013, 5.19298586729108, 0.13137735668614, 0.59792298331528, -0.00382027744166, -0.61517770937595, -0.00382029585430, -0.61517862505359, -0.08090939637086, -0.53021816703835, -16.24188094157861, -0.00510854901542, -0.02269679365691, -0.50853981751734, -6.12138001264392, -0.00482180294007, -0.02142234879207, -0.06025320912177, -1.47584079782562, 2.53407733270991, 0.07674309158364, 0.34936840180532, -1.50471350641201, 1.37898530113546, 0.06713251098255, 0.30570660563217, -0.00754976535448, -0.40789638061555, -0.00834219774206, -0.44969569608266, -0.00204692757911, -0.01341399439047, -0.00510854901542, -16.04236184786856, -0.00007356063921, -0.01286555362265, -0.00482180294007, -5.93306194426103, -0.00006900410769, -0.00152434603336, -0.03733729915653, 0.07674309322312, -0.49782092320421, 0.00892573921349, -0.03806775076035, 0.06713251394493, -1.27359654675261, 0.00789151565043, 0.00047488875754, 0.02480628475649, -0.00087694337691, -0.04650259088225, -0.00931594490487, -0.06104956226654, -0.02269679365691, -0.00007356063921, -16.04748470532096, -0.05855350718512, -0.02142234879207, -0.00006900410769, -5.93789939169483, -0.00693758449464, -0.16992904177110, 0.34936839332011, 0.00892573881006, -0.45999490606717, -0.17325345512880, 0.30570659028400, 0.00789151492104, -1.24092556842839, -0.00450441495552, -0.23871825547551, 0.00267462693812, 0.13997511154931, -6.99694275966503, -10.22182227543558, -0.50853981751734, -0.01286555362265, -0.05855350718512, -10.92053408135509, -0.97537245876588, -0.02467595734669, -0.11230482922769, -1.01629421797068, -2.93235619728210, 3.36061879628947, 0.08502029534441, 0.38694334648519, -4.81872860174643, 6.41446297642136, 0.16227950247805, 0.73856449435854, -0.16041834392196, -1.43134536726953, -0.16041869987849, -1.43134692002733, -0.01144764484248, -0.32232590229252, -6.12138001264392, -0.00482180294007, -0.02142234879207, -0.97537245876588, -8.85577152241679, -0.02240720258549, -0.09912151442948, -2.72349074024797, -5.18770373238022, 3.95909501249376, 0.14873120178688, 0.67970033407549, -4.59239766535305, 1.89032024285591, 0.13244341062518, 0.60702892828420, -0.43278615038352, -1.83971883303472, -0.47770991525137, -2.00461541394299, -0.00028961407445, -0.00815452603136, -0.00482180294007, -5.93306194426103, -0.00006900410769, -0.02467595734669, -0.02240720258549, -7.98241511301094, 0.00007882805410, -0.06890159651819, -0.13124372887673, 0.14873121493761, -1.92759801054610, 0.01972688835856, -0.11618308403742, 0.13244342779353, -3.35897634585518, 0.01920739790762, 0.02680190776810, 0.09202675318482, -0.04983666885603, -0.18928484500686, -0.00131808706314, -0.03711275181539, -0.02142234879207, -0.00006900410769, -5.93789939169483, -0.11230482922769, -0.09912151442948, 0.00007882805410, -8.00689395079877, -0.31358407995655, -0.59731477031943, 0.67970026668212, 0.01972688513939, -1.86644078204207, -0.52877091103576, 0.60702883951445, 0.01920739368506, -3.31272672005513, -0.25591578213734, -0.96828622109390, 0.15108144661524, 0.52564908639873, -0.00000003401272, -0.01829450884991, -0.06025320912177, -0.00152434603336, -0.00693758449464, -1.01629421797068, -2.72349074024797, -0.06890159651819, -0.31358407995655, -38.87807716825197, -3.15917044851662, 0.10400766432637, 0.00263128769704, 0.01197550574590, -4.27416641262986, 0.01543123703650, 0.00039039453897, 0.00177676202032, -0.38334874155131, -1.86644147412224, -0.38334872695081, -1.86644145774519, -0.28482632174510, -1.06709830173419, -1.47584079782562, -0.03733729915653, -0.16992904177110, -2.93235619728210, -5.18770373238022, -0.13124372887673, -0.59731477031943, -3.15917044851662, -10.68271477654967, 0.76384347362769, 0.01932445991392, 0.08794940200780, -7.67531071394903, 0.48085713380351, 0.01216519471422, 0.05536618163508, -1.63757527138621, -3.78188502256560, -1.63757535643941, -3.78188516879917, 0.77515940642681, 2.10692583467531, 2.53407733270991, 0.07674309322312, 0.34936839332011, 3.36061879628947, 3.95909501249376, 0.14873121493761, 0.67970026668212, 0.10400766432637, 0.76384347362769, -11.54129928798982, -0.01680741528377, -0.05234140675594, 0.74114938910831, -5.11987738939424, -0.01524350640974, -0.04849610637741, -1.02321676991181, -0.60721600539627, -1.45751689547939, -0.97092401917756, 0.01961075900156, 0.05330311951094, 0.07674309158364, -0.49782092320421, 0.00892573881006, 0.08502029534441, 0.14873120178688, -1.92759801054610, 0.01972688513939, 0.00263128769704, 0.01932445991392, -0.01680741528377, -10.97685944711426, 0.02053520074463, 0.01875032307762, -0.01524350640974, -4.60373587402547, 0.01767080134950, 0.33907936654877, 0.29028151723229, -0.40183977255521, -0.33020716010092, 0.08925224023537, 0.24259249224537, 0.34936840180532, 0.00892573921349, -0.45999490606717, 0.38694334648519, 0.67970033407549, 0.01972688835856, -1.86644078204207, 0.01197550574590, 0.08794940200780, -0.05234140675594, 0.02053520074463, -11.09767624876566, 0.08533638974381, -0.04849610637741, 0.01767080134950, -4.70853920251756, -2.11018142222394, -1.73843948844945, 1.82455008568241, 1.55673300868284, -1.56996089260008, -2.90349820266013, -1.50471350641201, -0.03806775076035, -0.17325345512880, -4.81872860174643, -4.59239766535305, -0.11618308403742, -0.52877091103576, -4.27416641262986, -7.67531071394903, 0.74114938910831, 0.01875032307762, 0.08533638974381, -8.46916376533060, 1.09291658391101, 0.02764967662558, 0.12583906542055, -2.41259424581972, -4.86376248285845, -2.41259443964871, -4.86376286003544, 3.13868342338491, 5.19298586729108, 1.37898530113546, 0.06713251394493, 0.30570659028400, 6.41446297642136, 1.89032024285591, 0.13244342779353, 0.60702883951445, 0.01543123703650, 0.48085713380351, -5.11987738939424, -0.01524350640974, -0.04849610637741, 1.09291658391101, -7.49653542703279, -0.03613930781493, -0.12208915713504, -1.44524167661646, -1.12672427288000, -2.05262667480083, -1.75468325545835, 0.07940555670168, 0.13137735668614, 0.06713251098255, -1.27359654675261, 0.00789151492104, 0.16227950247805, 0.13244341062518, -3.35897634585518, 0.01920739368506, 0.00039039453897, 0.01216519471422, -0.01524350640974, -4.60373587402547, 0.01767080134950, 0.02764967662558, -0.03613930781493, -6.24356131019269, 0.03527479115708, 0.47385500905599, 0.49920283882029, -0.56234805291170, -0.57210006195713, 0.36138957302908, 0.59792298331528, 0.30570660563217, 0.00789151565043, -1.24092556842839, 0.73856449435854, 0.60702892828420, 0.01920739790762, -3.31272672005513, 0.00177676202032, 0.05536618163508, -0.04849610637741, 0.01767080134950, -4.70853920251756, 0.12583906542055, -0.12208915713504, 0.03527479115708, -6.45890904329889, -2.95280640969325, -3.01051734093168, 2.55006240372829, 2.67875304651509, -0.00009672012812, -0.00382027744166, -0.00754976535448, 0.00047488875754, -0.00450441495552, -0.16041834392196, -0.43278615038352, 0.02680190776810, -0.25591578213734, -0.38334874155131, -1.63757527138621, -1.02321676991181, 0.33907936654877, -2.11018142222394, -2.41259424581972, -1.44524167661646, 0.47385500905599, -2.95280640969325, -6.96884898788133, -4.16700132520773, -0.04505033377670, -0.73869161160424, -0.28451447736296, -0.61517770937595, -0.40789638061555, 0.02480628475649, -0.23871825547551, -1.43134536726953, -1.83971883303472, 0.09202675318482, -0.96828622109390, -1.86644147412224, -3.78188502256560, -0.60721600539627, 0.29028151723229, -1.73843948844945, -4.86376248285845, -1.12672427288000, 0.49920283882029, -3.01051734093168, -4.16700132520773, -5.71280328018470, -0.73869165979397, -2.23190541440297, -0.00009672082104, -0.00382029585430, -0.00834219774206, -0.00087694337691, 0.00267462693812, -0.16041869987849, -0.47770991525137, -0.04983666885603, 0.15108144661524, -0.38334872695081, -1.63757535643941, -1.45751689547939, -0.40183977255521, 1.82455008568241, -2.41259443964871, -2.05262667480083, -0.56234805291170, 2.55006240372829, -0.04505033377670, -0.73869165979397, -6.96884960768785, -4.16700172596888, -0.28451494884870, -0.61517862505359, -0.44969569608266, -0.04650259088225, 0.13997511154931, -1.43134692002733, -2.00461541394299, -0.18928484500686, 0.52564908639873, -1.86644145774519, -3.78188516879917, -0.97092401917756, -0.33020716010092, 1.55673300868284, -4.86376286003544, -1.75468325545835, -0.57210006195713, 2.67875304651509, -0.73869161160424, -2.23190541440297, -4.16700172596888, -5.71280390013362;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL: " << I << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL NORM: " << I.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL: " << Iexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL NORM: " << Iexp.norm() << std::endl;

    // return success or failure based on the error
    return (I - Iexp).norm() > 1e-8;
}
