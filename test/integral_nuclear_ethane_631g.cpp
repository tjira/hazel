#include "../include/integral.h"

int test_integral_nuclear_ethane_631g(int, char**) {
    // initialize the system
    System system("../example/molecule/ethane.xyz", "6-31G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix I = Integral::Nuclear(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Iexp(system.shells.nbf(), system.shells.nbf()); Iexp << -38.40958906937011, -3.34536770024852, -0.05833378025930, 0.00174461520004, 0.00161987099442, -4.03725587764546, -0.00979973029626, 0.00029308504190, 0.00027212875254, -0.00000215140916, -0.14573397938483, 0.37511118481784, -0.01121857029487, -0.01041627514165, -1.00607548661353, 2.34238778013882, -0.07005454167365, -0.06504459655263, -0.00045922040746, -0.27361842434755, -0.00045922303155, -0.27361885876399, -0.00045923408902, -0.27362068879119, -0.68039529057868, -2.00911505335325, -0.68039541783017, -2.00911515357720, -0.68039688172877, -2.00911630824429, -3.34536770024852, -9.97355067636436, -0.42540858439573, 0.01272289065662, 0.01181315478253, -7.57397225285072, -0.32073979794921, 0.00959251374279, 0.00890657763096, -0.14573398000171, -1.19356981626743, 1.85201185880434, -0.05538868467030, -0.05142756684996, -2.64810889575269, 4.75424985170656, -0.14218682954067, -0.13201834249192, -0.05780766104814, -0.93401768757577, -0.05780782788439, -0.93401884757174, -0.05780854182405, -0.93402374268819, -2.36758433242223, -4.28015167673076, -2.36758442567257, -4.28015169554256, -2.36758752672589, -4.28015390231305, -0.05833378025930, -0.42540858439573, -10.60773027316474, 0.00515666989105, 0.00478779503905, -0.44045640711446, -4.91293179461007, 0.00618010412172, 0.00573806858814, -0.37511118638532, -1.85201185812477, 2.54147276600889, -0.09310751940911, -0.08644894220290, -2.15530571467174, 2.26980018446050, -0.11414837515260, -0.10598507004643, -0.11540054099539, -0.89629839373130, -0.11445983756437, -0.88915139539202, -0.11180691489046, -0.86899396691686, 1.06294532932918, 0.55717781868480, 0.91840188408186, 0.45668499646947, 1.11412654760832, 0.59276037066193, 0.00174461520004, 0.01272289065662, 0.00515666989105, -10.43546707524964, -0.00014313394167, 0.01317293362716, 0.00618010412172, -4.70647857986673, -0.00017156228575, 0.01121857103906, 0.05538873782152, -0.09310760059406, -0.56894590535064, 0.00258545532585, 0.06445947609818, -0.11414851153286, -1.54352476048599, 0.00316974374357, 0.00182459696365, 0.01444891233259, -0.04148284426908, -0.31451165133386, 0.04987723473910, 0.37945228511301, 2.41358697353390, 1.68346847394055, -2.56062574476837, -1.77482009083363, 0.05446130625061, 0.04330180823975, 0.00161987099442, 0.01181315478253, 0.00478779503905, -0.00014313394167, -10.43544595993880, 0.01223098055990, 0.00573806858814, -0.00017156228575, -4.70645318318590, 0.01041627594276, 0.05142761836868, -0.08644902130352, 0.00258545543716, -0.56932994182094, 0.05984967687834, -0.10598523128265, 0.00316974477864, -1.54399560432943, -0.04958565864822, -0.37610328816175, 0.03094436310003, 0.23559988592623, 0.02812944316983, 0.21421554117294, -1.54059600099948, -1.06604007688204, -1.38867732151556, -0.96041957693154, 2.84331961584636, 1.98184648972859, -4.03725587764546, -7.57397225285072, -0.44045640711446, 0.01317293362716, 0.01223098055990, -8.01981415157133, -0.76466292524761, 0.02286913554772, 0.02123370465696, -1.00607549146662, -2.64810890818862, 2.15530572081206, -0.06445928414910, -0.05984947798075, -4.10506719472138, 4.89547846280071, -0.14641046823208, -0.13593992563115, -0.52781408421272, -1.93862827471729, -0.52781482362202, -1.93862989726498, -0.52781804580476, -1.93863681815699, -2.81491987950824, -5.12418452949800, -2.81491979010611, -5.12418429296611, -2.81492203372956, -5.12418656144777, -0.00979973029626, -0.32073979794921, -4.91293179461007, 0.00618010412172, 0.00573806858814, -0.76466292524761, -6.94603022755249, 0.02125826982158, 0.01973792711379, -2.34238779149995, -4.75424987725706, 2.26980018545112, -0.11414816496335, -0.10598485244838, -4.89547846962823, 1.87530499550737, -0.15098779916816, -0.14018989900669, -1.27295319141292, -2.83858035396157, -1.26228431249804, -2.81755716791010, -1.23219392043458, -2.75826193564601, 1.21077828214035, 0.84441403677786, 1.04650786998546, 0.68486585809894, 1.26894351629474, 0.90090670827320, 0.00029308504190, 0.00959251374279, 0.00618010412172, -4.70647857986673, -0.00017156228575, 0.02286913554772, 0.02125826982158, -6.23586905052215, -0.00059024354882, 0.07005454555924, 0.14218697239680, -0.11414848683703, -1.54352479826875, 0.00316969738062, 0.14641081935507, -0.15098821765471, -3.16871171584235, 0.00419269913003, 0.01962483426335, 0.04854795558025, -0.47145007420499, -0.91905712849828, 0.56450266924195, 1.12216601866940, 2.74290369652673, 2.67397511564097, -2.91017490973745, -2.81660542941558, 0.06181117580251, 0.06995008629571, 0.00027212875254, 0.00890657763096, 0.00573806858814, -0.00017156228575, -4.70645318318590, 0.02123370465696, 0.01973792711379, -0.00059024354882, -6.23578141138304, 0.06504460107770, 0.13201848815282, -0.10598516600760, 0.00316969782039, -1.54399559486534, 0.13594027347989, -0.14019031360597, 0.00419269990884, -3.16933448226406, -0.56325474124371, -1.10065551100702, 0.34989761272993, 0.69860802941466, 0.31797655749837, 0.63570771956034, -1.75092879144127, -1.69139090939209, -1.57827671470982, -1.52370241335818, 3.23128823205507, 3.14761062257470, -0.00000215140916, -0.14573398000171, -0.37511118638532, 0.01121857103906, 0.01041627594276, -1.00607549146662, -2.34238779149995, 0.07005454555924, 0.06504460107770, -38.40958918413209, -3.34536772538814, 0.05833377535294, -0.00174453990788, -0.00161977517818, -4.03725589879160, 0.00979972947203, -0.00029307239350, -0.00027211265628, -0.68039483889491, -2.00911470438959, -0.68039519678521, -2.00911498691365, -0.68039836515811, -2.00911748622694, -0.00045922656482, -0.27361944469824, -0.00045922336540, -0.27361891524838, -0.00045922759342, -0.27361961444053, -0.14573397938483, -1.19356981626743, -1.85201185812477, 0.05538873782152, 0.05142761836868, -2.64810890818862, -4.75424987725706, 0.14218697239680, 0.13201848815282, -3.34536772538814, -9.97355078705400, 0.42540855088063, -0.01272238009083, -0.01181250499800, -7.57397233460368, 0.32073977760587, -0.00959220648586, -0.00890618750275, -2.36758314418327, -4.28015078412574, -2.36758400795268, -4.28015143762600, -2.36759077057999, -4.28015627808907, -0.05780804861826, -0.93402040325964, -0.05780784906588, -0.93401897460538, -0.05780812575289, -0.93402089270577, 0.37511118481784, 1.85201185880434, 2.54147276600889, -0.09310760059406, -0.08644902130352, 2.15530572081206, 2.26980018545112, -0.11414848683703, -0.10598516600760, 0.05833377535294, 0.42540855088063, -10.60773040563349, 0.00515642354094, 0.00478768806178, 0.44045637783719, -4.91293187086220, 0.00617986573343, 0.00573794059361, -1.11415297338289, -0.59278003095312, -1.06291766549326, -0.55715875673290, -0.91840381411362, -0.45668476002121, 0.11446078042520, 0.88915674404927, 0.11180558734944, 0.86898966463956, 0.11540094298239, 0.89629740751687, -0.01121857029487, -0.05538868467030, -0.09310751940911, -0.56894590535064, 0.00258545543716, -0.06445928414910, -0.11414816496335, -1.54352479826875, 0.00316969782039, -0.00174453990788, -0.01272238009083, 0.00515642354094, -10.43546727769415, -0.00014330857781, -0.01317249014544, 0.00617986573343, -4.70647866064188, -0.00017167747895, -0.05524690595031, -0.04384791698385, -2.41317122202098, -1.68317937312907, 2.56100536818635, 1.77508086060449, 0.04149065787427, 0.31457081379934, -0.04986976879664, -0.37939778912385, -0.00183907225845, -0.01455964289130, -0.01041627514165, -0.05142756684996, -0.08644894220290, 0.00258545532585, -0.56932994182094, -0.05984947798075, -0.10598485244838, 0.00316969738062, -1.54399559486534, -0.00161977517818, -0.01181250499800, 0.00478768806178, -0.00014330857781, -10.43544594961960, -0.01223041721954, 0.00573794059361, -0.00017167747895, -4.70645316994394, -2.84328923060614, -1.98182770910256, 1.54126543121404, 1.06650582650961, 1.38799028335895, 0.95994031446320, -0.03093215985817, -0.23550582684516, -0.02814181670644, -0.21431178773088, 0.04958652445384, 0.37610814410082, -1.00607548661353, -2.64810889575269, -2.15530571467174, 0.06445947609818, 0.05984967687834, -4.10506719472138, -4.89547846962823, 0.14641081935507, 0.13594027347989, -4.03725589879160, -7.57397233460368, 0.44045637783719, -0.01317249014544, -0.01223041721954, -8.01981421843942, 0.76466289891657, -0.02286871001966, -0.02123317712541, -2.81491882329891, -5.12418329212731, -2.81491953005846, -5.12418408362024, -2.81492445256786, -5.12418909251322, -0.52781577037940, -1.93863202284579, -0.52781492036130, -1.93863006466200, -0.52781618360170, -1.93863281300453, 2.34238778013882, 4.75424985170656, 2.26980018446050, -0.11414851153286, -0.10598523128265, 4.89547846280071, 1.87530499550737, -0.15098821765471, -0.14019031360597, 0.00979972947203, 0.32073977760587, -4.91293187086220, 0.00617986573343, 0.00573794059361, 0.76466289891657, -6.94603032519366, 0.02125776857146, 0.01973758172383, -1.26897484244714, -0.90093840346722, -1.21074686846792, -0.84438384430475, -1.04650852538602, -0.68486485417940, 1.26229230928499, 2.81757137979656, 1.23218680612696, 2.75825332327975, 1.27295226080162, 2.83857467705301, -0.07005454167365, -0.14218682954067, -0.11414837515260, -1.54352476048599, 0.00316974477864, -0.14641046823208, -0.15098779916816, -3.16871171584235, 0.00419269990884, -0.00029307239350, -0.00959220648586, 0.00617986573343, -4.70647866064188, -0.00017167747895, -0.02286871001966, 0.02125776857146, -6.23586900410606, -0.00059032023733, -0.06270426883517, -0.07081820592288, -2.74243116424617, -2.67351564911139, 2.91060225876597, 2.81701906829858, 0.47153754364292, 0.91923008983700, -0.56442175663788, -1.12200813993606, -0.01978868133568, -0.04887284768625, -0.06504459655263, -0.13201834249192, -0.10598507004643, 0.00316974374357, -1.54399560432943, -0.13593992563115, -0.14018989900669, 0.00419269913003, -3.16933448226406, -0.00027211265628, -0.00890618750275, 0.00573794059361, -0.00017167747895, -4.70645316994394, -0.02123317712541, 0.01973758172383, -0.00059032023733, -6.23578145464139, -3.23125692245249, -3.14758145935231, 1.75168977488732, 1.69213100455716, 1.57749345254687, 1.52294010110619, -0.34975868184623, -0.69833173632038, -0.31811872621706, -0.63599123026449, 0.56326211562150, 1.10066838095995, -0.00045922040746, -0.05780766104814, -0.11540054099539, 0.00182459696365, -0.04958565864822, -0.52781408421272, -1.27295319141292, 0.01962483426335, -0.56325474124371, -0.68039483889491, -2.36758314418327, -1.11415297338289, -0.05524690595031, -2.84328923060614, -2.81491882329891, -1.26897484244714, -0.06270426883517, -3.23125692245249, -7.22888521855069, -4.39801082145287, -0.16989873962587, -1.15086379365336, -0.16989909569150, -1.15086455969369, -0.00343912656328, -0.24665030692073, -0.00344272344814, -0.24675213803408, -0.00013761957865, -0.06880987279778, -0.27361842434755, -0.93401768757577, -0.89629839373130, 0.01444891233259, -0.37610328816175, -1.93862827471729, -2.83858035396157, 0.04854795558025, -1.10065551100702, -2.00911470438959, -4.28015078412574, -0.59278003095312, -0.04384791698385, -1.98182770910256, -5.12418329212731, -0.90093840346722, -0.07081820592288, -3.14758145935231, -4.39801082145287, -5.92225357594323, -1.15086383881962, -2.81322992737478, -1.15086546156472, -2.81323194137651, -0.24665031054325, -1.10705462817093, -0.24675214987541, -1.10730997495890, -0.06880988450315, -0.54492189533615, -0.00045922303155, -0.05780782788439, -0.11445983756437, -0.04148284426908, 0.03094436310003, -0.52781482362202, -1.26228431249804, -0.47145007420499, 0.34989761272993, -0.68039519678521, -2.36758400795268, -1.06291766549326, -2.41317122202098, 1.54126543121404, -2.81491953005846, -1.21074686846792, -2.74243116424617, 1.75168977488732, -0.16989873962587, -1.15086383881962, -7.22888621353863, -4.39801146391926, -0.16989954529144, -1.15086598005291, -0.00013761971398, -0.06880990416968, -0.00343911310988, -0.24664993027596, -0.00344276926556, -0.24675346871465, -0.27361885876399, -0.93401884757174, -0.88915139539202, -0.31451165133386, 0.23559988592623, -1.93862989726498, -2.81755716791010, -0.91905712849828, 0.69860802941466, -2.00911498691365, -4.28015143762600, -0.55715875673290, -1.68317937312907, 1.06650582650961, -5.12418408362024, -0.84438384430475, -2.67351564911139, 1.69213100455716, -1.15086379365336, -2.81322992737478, -4.39801146391926, -5.92225442752193, -1.15086659816776, -2.81323378642613, -0.06880989594488, -0.54492203032816, -0.24664993362679, -1.10705364237648, -0.24675351130307, -1.10731362734018, -0.00045923408902, -0.05780854182405, -0.11180691489046, 0.04987723473910, 0.02812944316983, -0.52781804580476, -1.23219392043458, 0.56450266924195, 0.31797655749837, -0.68039836515811, -2.36759077057999, -0.91840381411362, 2.56100536818635, 1.38799028335895, -2.81492445256786, -1.04650852538602, 2.91060225876597, 1.57749345254687, -0.16989909569150, -1.15086546156472, -0.16989954529144, -1.15086659816776, -7.22889143232901, -4.39801478737246, -0.00344281073522, -0.24675475853428, -0.00013762140309, -0.06881026066222, -0.00343919876517, -0.24665248695566, -0.27362068879119, -0.93402374268819, -0.86899396691686, 0.37945228511301, 0.21421554117294, -1.93863681815699, -2.75826193564601, 1.12216601866940, 0.63570771956034, -2.00911748622694, -4.28015627808907, -0.45668476002121, 1.77508086060449, 0.95994031446320, -5.12418909251322, -0.68486485417940, 2.81701906829858, 1.52294010110619, -1.15086455969369, -2.81323194137651, -1.15086598005291, -2.81323378642613, -4.39801478737246, -5.92225845428839, -0.24675467561871, -1.10731705449929, -0.06881024458588, -0.54492371498375, -0.24665245150475, -1.10706057750713, -0.68039529057868, -2.36758433242223, 1.06294532932918, 2.41358697353390, -1.54059600099948, -2.81491987950824, 1.21077828214035, 2.74290369652673, -1.75092879144127, -0.00045922656482, -0.05780804861826, 0.11446078042520, 0.04149065787427, -0.03093215985817, -0.52781577037940, 1.26229230928499, 0.47153754364292, -0.34975868184623, -0.00343912656328, -0.24665031054325, -0.00013761971398, -0.06880989594488, -0.00344281073522, -0.24675467561871, -7.22888694354412, -4.39801194126860, -0.16989890211889, -1.15086433771696, -0.16989875824028, -1.15086396383628, -2.00911505335325, -4.28015167673076, 0.55717781868480, 1.68346847394055, -1.06604007688204, -5.12418452949800, 0.84441403677786, 2.67397511564097, -1.69139090939209, -0.27361944469824, -0.93402040325964, 0.88915674404927, 0.31457081379934, -0.23550582684516, -1.93863202284579, 2.81757137979656, 0.91923008983700, -0.69833173632038, -0.24665030692073, -1.10705462817093, -0.06880990416968, -0.54492203032816, -0.24675475853428, -1.10731705449929, -4.39801194126860, -5.92225512721125, -1.15086435900856, -2.81323083701438, -1.15086413873100, -2.81323059834695, -0.68039541783017, -2.36758442567257, 0.91840188408186, -2.56062574476837, -1.38867732151556, -2.81491979010611, 1.04650786998546, -2.91017490973745, -1.57827671470982, -0.00045922336540, -0.05780784906588, 0.11180558734944, -0.04986976879664, -0.02814181670644, -0.52781492036130, 1.23218680612696, -0.56442175663788, -0.31811872621706, -0.00344272344814, -0.24675214987541, -0.00343911310988, -0.24664993362679, -0.00013762140309, -0.06881024458588, -0.16989890211889, -1.15086435900856, -7.22888634809905, -4.39801154450436, -0.16989929497707, -1.15086529064311, -2.00911515357720, -4.28015169554256, 0.45668499646947, -1.77482009083363, -0.96041957693154, -5.12418429296611, 0.68486585809894, -2.81660542941558, -1.52370241335818, -0.27361891524838, -0.93401897460538, 0.86898966463956, -0.37939778912385, -0.21431178773088, -1.93863006466200, 2.75825332327975, -1.12200813993606, -0.63599123026449, -0.24675213803408, -1.10730997495890, -0.24664993027596, -1.10705364237648, -0.06881026066222, -0.54492371498375, -1.15086433771696, -2.81323083701438, -4.39801154450436, -5.92225447989973, -1.15086568283687, -2.81323246438063, -0.68039688172877, -2.36758752672589, 1.11412654760832, 0.05446130625061, 2.84331961584636, -2.81492203372956, 1.26894351629474, 0.06181117580251, 3.23128823205507, -0.00045922759342, -0.05780812575289, 0.11540094298239, -0.00183907225845, 0.04958652445384, -0.52781618360170, 1.27295226080162, -0.01978868133568, 0.56326211562150, -0.00013761957865, -0.06880988450315, -0.00344276926556, -0.24675351130307, -0.00343919876517, -0.24665245150475, -0.16989875824028, -1.15086413873100, -0.16989929497707, -1.15086568283687, -7.22888868517829, -4.39801303119715, -2.00911630824429, -4.28015390231305, 0.59276037066193, 0.04330180823975, 1.98184648972859, -5.12418656144777, 0.90090670827320, 0.06995008629571, 3.14761062257470, -0.27361961444053, -0.93402089270577, 0.89629740751687, -0.01455964289130, 0.37610814410082, -1.93863281300453, 2.83857467705301, -0.04887284768625, 1.10066838095995, -0.06880987279778, -0.54492189533615, -0.24675346871465, -1.10731362734018, -0.24665248695566, -1.10706057750713, -1.15086396383628, -2.81323059834695, -1.15086529064311, -2.81323246438063, -4.39801303119715, -5.92225627257075;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL: " << I << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED INTEGRAL NORM: " << I.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL: " << Iexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED INTEGRAL NORM: " << Iexp.norm() << std::endl;

    // return success or failure based on the error
    return (I - Iexp).norm() > 1e-8;
}
