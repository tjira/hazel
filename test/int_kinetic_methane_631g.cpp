#include "../include/integral.h"

int test_int_kinetic_methane_631g(int, char**) {
    // initialize the system
    System system("../example/molecule/methane.xyz", "6-31G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix T = Integral::Kinetic(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Texp(system.shells.nbf(), system.shells.nbf()); Texp << 16.20756797345014, -1.24756866124283, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.08995049652200, -0.00000000000000, 0.00000000000000, -0.00000000000000, -0.03489734899803, 0.02454593172330, -0.03489734797607, 0.02454591678327, -0.03489734681451, 0.02454589980282, -0.03489734632109, 0.02454589258990, -1.24756866124283, 0.93224556748206, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.30671845828079, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.04555542749372, 0.11596076756403, 0.04555531225668, 0.11596071677002, 0.04555518128132, 0.11596065903885, 0.04555512564590, 0.11596063451592, -0.00000000000000, 0.00000000000000, 2.17833218887281, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.11904137752404, 0.06469457908306, 0.04618126129087, 0.02509782600878, 0.07530546458462, 0.04092580425145, -0.24052934395069, -0.13071907743320, 0.00000000000000, 0.00000000000000, -0.00000000000000, 2.17833218887281, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.03625259493654, 0.01970194245790, 0.18549649840402, 0.10081056064837, -0.20966499262328, -0.11394536231618, -0.01208532808725, -0.00656794265554, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 2.17833218887281, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.21068184434218, 0.11449777819823, -0.15274214609732, -0.08300976846025, -0.10119964530608, -0.05499835764852, 0.04325752565934, 0.02350891476838, 0.08995049652200, 0.30671845828079, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.25307171730000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.09597472474705, 0.13475271342643, 0.09597467596088, 0.13475267626812, 0.09597462051178, 0.13475263403493, 0.09597459695822, 0.13475261609520, -0.00000000000000, -0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.42178619550000, 0.00000000000000, 0.00000000000000, 0.13197837551677, 0.10052220536350, 0.05120012000858, 0.03899691722404, 0.08348954294884, 0.06359038563419, -0.26666979627582, -0.20311090308243, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.42178619550000, 0.00000000000000, 0.04019239937833, 0.03061280765535, 0.20565577279576, 0.15663910840480, -0.23245105123573, -0.17704794477327, -0.01339874763727, -0.01020524922877, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.37667339168477, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.42178619550000, 0.23357800577822, 0.17790623784615, -0.16934176312972, -0.12898029766799, -0.11219786213118, -0.08545627474119, 0.04795870377187, 0.03652807993182, -0.03489734899803, 0.04555542749372, 0.11904137752404, 0.03625259493654, 0.21068184434218, 0.09597472474705, 0.13197837551677, 0.04019239937833, 0.23357800577822, 1.39567838062028, 0.25973499598884, -0.02819115556858, 0.00133388871781, -0.02819145161425, 0.00133417724292, -0.02819133613316, 0.00133406469517, 0.02454593172330, 0.11596076756403, 0.06469457908306, 0.01970194245790, 0.11449777819823, 0.13475271342643, 0.10052220536350, 0.03061280765535, 0.17790623784615, 0.25973499598884, 0.24191663820000, 0.00133388871781, 0.03926934292096, 0.00133417724292, 0.03926979626191, 0.00133406469517, 0.03926961942324, -0.03489734797607, 0.04555531225668, 0.04618126129087, 0.18549649840402, -0.15274214609732, 0.09597467596088, 0.05120012000858, 0.20565577279576, -0.16934176312972, -0.02819115556858, 0.00133388871781, 1.39567838062028, 0.25973499598884, -0.02819172616330, 0.00133444481954, -0.02819170312257, 0.00133442236388, 0.02454591678327, 0.11596071677002, 0.02509782600878, 0.10081056064837, -0.08300976846025, 0.13475267626812, 0.03899691722404, 0.15663910840480, -0.12898029766799, 0.00133388871781, 0.03926934292096, 0.25973499598884, 0.24191663820000, 0.00133444481954, 0.03927021668506, 0.00133442236388, 0.03927018140226, -0.03489734681451, 0.04555518128132, 0.07530546458462, -0.20966499262328, -0.10119964530608, 0.09597462051178, 0.08348954294884, -0.23245105123573, -0.11219786213118, -0.02819145161425, 0.00133417724292, -0.02819172616330, 0.00133444481954, 1.39567838062028, 0.25973499598884, -0.02819169562055, 0.00133441505236, 0.02454589980282, 0.11596065903885, 0.04092580425145, -0.11394536231618, -0.05499835764852, 0.13475263403493, 0.06359038563419, -0.17704794477327, -0.08545627474119, 0.00133417724292, 0.03926979626191, 0.00133444481954, 0.03927021668506, 0.25973499598884, 0.24191663820000, 0.00133441505236, 0.03927016991424, -0.03489734632109, 0.04555512564590, -0.24052934395069, -0.01208532808725, 0.04325752565934, 0.09597459695822, -0.26666979627582, -0.01339874763727, 0.04795870377187, -0.02819133613316, 0.00133406469517, -0.02819170312257, 0.00133442236388, -0.02819169562055, 0.00133441505236, 1.39567838062028, 0.25973499598884, 0.02454589258990, 0.11596063451592, -0.13071907743320, -0.00656794265554, 0.02350891476838, 0.13475261609520, -0.20311090308243, -0.01020524922877, 0.03652807993182, 0.00133406469517, 0.03926961942324, 0.00133442236388, 0.03927018140226, 0.00133441505236, 0.03927016991424, 0.25973499598884, 0.24191663820000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED KINETIC: " << T << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED KINETIC NORM: " << T.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED KINETIC: " << Texp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED KINETIC NORM: " << Texp.norm() << std::endl;

    // return success or failure based on the error
    return (T - Texp).norm() > 1e-8;
}
