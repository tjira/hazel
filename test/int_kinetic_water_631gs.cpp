#include "../include/integral.h"

int test_int_kinetic_water_631gs(int, char**) {
    // initialize the system
    System system("../example/molecule/water.xyz", "6-31G*", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix T = Integral::Kinetic(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Texp(system.shells.nbf(), system.shells.nbf()); Texp << 29.54014709713746, -2.18540375982758, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.13128251236952, 0.00000000000000, -0.00000000000000, -0.00000000000000, -0.46582833723327, -0.00000000000000, -0.00000000000000, -0.46582833723327, 0.00000000000000, -0.46582833723327, -0.02353053250657, 0.01996166586982, -0.02353058790425, 0.01996159265608, -2.18540375982758, 1.71121112543917, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.48004786990615, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.24976369988867, 0.00000000000000, 0.00000000000000, 0.24976369988867, 0.00000000000000, 0.24976369988867, 0.00310987807222, 0.10363739531739, 0.00310905287297, 0.10363707624012, 0.00000000000000, 0.00000000000000, 4.25187686617585, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.54724330534162, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.13259525246346, 0.05885559193408, 0.08152301996283, 0.03618626243517, 0.00000000000000, 0.00000000000000, 0.00000000000000, 4.25187686617585, 0.00000000000000, -0.00000000000000, -0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.09556573685918, -0.04241915081397, 0.16974507603301, 0.07534607858257, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 4.25187686617585, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.09388120243374, 0.04167142969349, -0.00824231255372, -0.00365857993580, 0.13128251236952, 0.48004786990615, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.40500873390000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.32808286422005, 0.00000000000000, 0.00000000000000, 0.32808286422005, 0.00000000000000, 0.32808286422005, 0.12987348639058, 0.15492112439286, 0.12987284198233, 0.15492079429030, 0.00000000000000, -0.00000000000000, 0.54724330534162, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.67501455650000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.28935511813595, 0.14822401530270, 0.17790439804364, 0.09113283481452, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.54724330534162, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.67501455650000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.20854770110458, -0.10682989759782, 0.37042783236308, 0.18975437835529, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.54724330534162, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.67501455650000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.20487163692716, 0.10494681014321, -0.01798686621308, -0.00921390435230, -0.46582833723327, 0.24976369988867, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.32808286422005, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.73333333333333, 0.00000000000000, 0.00000000000000, -0.13333333333333, 0.00000000000000, -0.13333333333333, 0.21645155493660, 0.11601713805369, 0.02864880102196, 0.09761972534122, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.93333333333333, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.21761925648640, -0.02131801634924, 0.23765716495693, 0.02328105546740, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.93333333333333, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.21378328826977, 0.02094224430371, -0.01153992021439, -0.00113045833333, -0.46582833723327, 0.24976369988867, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.32808286422005, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.13333333333333, 0.00000000000000, 0.00000000000000, 1.73333333333333, 0.00000000000000, -0.13333333333333, 0.07135518172277, 0.10180347467513, 0.40935328450953, 0.13491379218903, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.93333333333333, 0.00000000000000, -0.15408061067125, -0.01509376068288, -0.02402811666079, -0.00235381044312, -0.46582833723327, 0.24976369988867, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.32808286422005, 0.00000000000000, 0.00000000000000, 0.00000000000000, -0.13333333333333, 0.00000000000000, 0.00000000000000, -0.13333333333333, 0.00000000000000, 1.73333333333333, 0.06587449953873, 0.10126658619251, -0.08432344538223, 0.08655288822192, -0.02353053250657, 0.00310987807222, 0.13259525246346, -0.09556573685918, 0.09388120243374, 0.12987348639058, 0.28935511813595, -0.20854770110458, 0.20487163692716, 0.21645155493660, -0.21761925648640, 0.21378328826977, 0.07135518172277, -0.15408061067125, 0.06587449953873, 1.39567838062028, 0.25973499598884, -0.04533491904691, 0.02471998848966, 0.01996166586982, 0.10363739531739, 0.05885559193408, -0.04241915081397, 0.04167142969349, 0.15492112439286, 0.14822401530270, -0.10682989759782, 0.10494681014321, 0.11601713805369, -0.02131801634924, 0.02094224430371, 0.10180347467513, -0.01509376068288, 0.10126658619251, 0.25973499598884, 0.24191663820000, 0.02471998848966, 0.06971835628977, -0.02353058790425, 0.00310905287297, 0.08152301996283, 0.16974507603301, -0.00824231255372, 0.12987284198233, 0.17790439804364, 0.37042783236308, -0.01798686621308, 0.02864880102196, 0.23765716495693, -0.01153992021439, 0.40935328450953, -0.02402811666079, -0.08432344538223, -0.04533491904691, 0.02471998848966, 1.39567838062028, 0.25973499598884, 0.01996159265608, 0.10363707624012, 0.03618626243517, 0.07534607858257, -0.00365857993580, 0.15492079429030, 0.09113283481452, 0.18975437835529, -0.00921390435230, 0.09761972534122, 0.02328105546740, -0.00113045833333, 0.13491379218903, -0.00235381044312, 0.08655288822192, 0.02471998848966, 0.06971835628977, 0.25973499598884, 0.24191663820000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED KINETIC: " << T << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED KINETIC NORM: " << T.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED KINETIC: " << Texp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED KINETIC NORM: " << Texp.norm() << std::endl;

    // return success or failure based on the error
    return (T - Texp).norm() > 1e-8;
}
