#include "../include/integral.h"

int test_int_overlap_ethylene_321g(int, char**) {
    // initialize the system
    System system("../example/molecule/ethylene.xyz", "3-21G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix S = Integral::Overlap(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Sexp(system.shells.nbf(), system.shells.nbf()); Sexp << 1.00000000000000, 0.19144744450067, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.18031400188717, -0.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000002359661, 0.00826268636415, -0.02175943201284, -0.00030188257439, -0.00576368128367, 0.05670545925973, -0.11610060503577, -0.00161073825438, -0.03075295733237, 0.01981733932580, 0.08172752859498, 0.01981719427367, 0.08172738229874, 0.00000489902870, 0.01062109909267, 0.00000489847119, 0.01062080108929, 0.19144744450067, 1.00000000000000, -0.00000000000000, -0.00000000000000, -0.00000000000000, 0.76135740608460, -0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00826268636415, 0.12832606398052, -0.19980483994419, -0.00277202086078, -0.05292470022626, 0.30148468858309, -0.49564304745990, -0.00687637430327, -0.13128690833201, 0.19930742055214, 0.40493376912896, 0.19930664592091, 0.40493318053372, 0.00215675223531, 0.07675142274420, 0.00215661696654, 0.07674966177230, 0.00000000000000, -0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.02175943201284, 0.19980483994419, -0.26621366689421, -0.00473513362102, -0.09040535407546, 0.21367778573403, -0.16061014985386, -0.00503634564187, -0.09615623284176, -0.14096033037999, -0.11089732705273, -0.16695098771486, -0.13134524503872, 0.00491478595368, 0.07340978562782, 0.00466701315802, 0.06971167528147, -0.00000000000000, -0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00030188257439, 0.00277202086078, -0.00473513362102, 0.07502493082129, -0.00125425153612, 0.00296448914704, -0.00503634564187, 0.20233536805363, -0.00133403717050, -0.25239827909640, -0.19856859322794, 0.24813774733105, 0.19521725311514, -0.00231742762429, -0.03461429789822, 0.00245032941112, 0.03660083279331, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00576368128367, 0.05292470022626, -0.09040535407546, -0.00125425153612, 0.05114387581057, 0.05659939347887, -0.09615623284176, -0.00133403717050, 0.17693518783641, -0.07677738409056, -0.06040285696544, -0.00489426845967, -0.00385046473172, 0.00092615316451, 0.01383350280276, 0.00161080883955, 0.02406082412055, 0.18031400188717, 0.76135740608460, -0.00000000000000, -0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.05670545925973, 0.30148468858309, -0.21367778573403, -0.00296448914704, -0.05659939347887, 0.55076411945219, -0.58143779878983, -0.00806665998653, -0.15401239134028, 0.34205055881156, 0.67265041186742, 0.34205000953698, 0.67264977155301, 0.05496589177315, 0.22723697078920, 0.05496451156223, 0.22723357964784, -0.00000000000000, -0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.11610060503577, 0.49564304745990, -0.16061014985386, -0.00503634564187, -0.09615623284176, 0.58143779878983, -0.06305566640789, -0.00851591608912, -0.16258979596623, -0.23782583496273, -0.27724432765053, -0.28167756670298, -0.32836448940414, 0.13953053232771, 0.34282103988010, 0.13250128760576, 0.32555378768643, 0.00000000000000, -0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00161073825438, 0.00687637430327, -0.00503634564187, 0.20233536805363, -0.00133403717050, 0.00806665998653, -0.00851591608912, 0.55064597267929, -0.00225571265588, -0.42584201744876, -0.49642329157145, 0.41865482697681, 0.48804517912417, -0.06579165666515, -0.16164751740794, 0.06956736375902, 0.17092602781714, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.03075295733237, 0.13128690833201, -0.09615623284176, -0.00133403717050, 0.17693518783641, 0.15401239134028, -0.16258979596623, -0.00225571265588, 0.50769701350138, -0.12953747645432, -0.15100769254422, -0.00825754701653, -0.00962620219122, 0.02629344294522, 0.06460195702069, 0.04573251415858, 0.11236413980405, 0.00000002359661, 0.00826268636415, 0.02175943201284, 0.00030188257439, 0.00576368128367, 0.05670545925973, 0.11610060503577, 0.00161073825438, 0.03075295733237, 1.00000000000000, 0.19144744450067, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.18031400188717, -0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000489923097, 0.01062120720352, 0.00000489843911, 0.01062078394200, 0.01981717694273, 0.08172736481910, 0.01981733347759, 0.08172752269663, 0.00826268636415, 0.12832606398052, 0.19980483994419, 0.00277202086078, 0.05292470022626, 0.30148468858309, 0.49564304745990, 0.00687637430327, 0.13128690833201, 0.19144744450067, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.76135740608460, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00215680130981, 0.07675206159436, 0.00215660918323, 0.07674956044462, 0.19930655336720, 0.40493311020767, 0.19930738932067, 0.40493374539808, -0.02175943201284, -0.19980483994419, -0.26621366689421, -0.00473513362102, -0.09040535407546, -0.21367778573403, -0.16061014985386, -0.00503634564187, -0.09615623284176, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, -0.00466709417801, -0.06970913465857, -0.00491424371580, -0.07340475136150, 0.16697346884006, 0.13136297470605, 0.14099384797221, 0.11092370853691, -0.00030188257439, -0.00277202086078, -0.00473513362102, 0.07502493082129, -0.00125425153612, -0.00296448914704, -0.00503634564187, 0.20233536805363, -0.00133403717050, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, -0.00245042132688, -0.03660023640622, 0.00231739785762, 0.03461529858550, -0.24812454410307, -0.19520692980382, 0.25241066277499, 0.19857835779317, -0.00576368128367, -0.05292470022626, -0.09040535407546, -0.00125425153612, 0.05114387581057, -0.05659939347887, -0.09615623284176, -0.00133403717050, 0.17693518783641, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, -0.00161192303902, -0.02407617157489, -0.00092709464380, -0.01384814342805, 0.00478894791561, 0.00376760720297, 0.07667491715452, 0.06032225011843, 0.05670545925973, 0.30148468858309, 0.21367778573403, 0.00296448914704, 0.05659939347887, 0.55076411945219, 0.58143779878983, 0.00806665998653, 0.15401239134028, 0.18031400188717, 0.76135740608460, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.05496639249058, 0.22723820102999, 0.05496443214393, 0.22723338451813, 0.34204994390902, 0.67264969504747, 0.34205053666601, 0.67265038605135, -0.11610060503577, -0.49564304745990, -0.16061014985386, -0.00503634564187, -0.09615623284176, -0.58143779878983, -0.06305566640789, -0.00851591608912, -0.16258979596623, -0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, 0.00000000000000, -0.13249675644237, -0.32553812209094, -0.13952072030172, -0.34280063596865, 0.28171558542243, 0.32840883533420, 0.23788241058299, 0.27731028774901, -0.00161073825438, -0.00687637430327, -0.00503634564187, 0.20233536805363, -0.00133403717050, -0.00806665998653, -0.00851591608912, 0.55064597267929, -0.00225571265588, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, 0.00000000000000, -0.06956638656613, -0.17092124706647, 0.06579344391923, 0.16165365523705, -0.41863268269658, -0.48801940279968, 0.42586295630146, 0.49644771407932, -0.03075295733237, -0.13128690833201, -0.09615623284176, -0.00133403717050, 0.17693518783641, -0.15401239134028, -0.16258979596623, -0.00225571265588, 0.50769701350138, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.52895881204315, 0.00000000000000, 0.00000000000000, 0.00000000000000, 1.00000000000000, -0.04576178799015, -0.11243449972542, -0.02632122458134, -0.06467091415845, 0.00807985409285, 0.00941905811964, 0.12936460977760, 0.15080617803581, 0.01981733932580, 0.19930742055214, -0.14096033037999, -0.25239827909640, -0.07677738409056, 0.34205055881156, -0.23782583496273, -0.42584201744876, -0.12953747645432, 0.00000489923097, 0.00215680130981, -0.00466709417801, -0.00245042132688, -0.00161192303902, 0.05496639249058, -0.13249675644237, -0.06956638656613, -0.04576178799015, 1.00000000000000, 0.64589812339497, 0.00589365702565, 0.10571395437803, 0.00011194644175, 0.02484719195919, 0.00000080175806, 0.00409205344877, 0.08172752859498, 0.40493376912896, -0.11089732705273, -0.19856859322794, -0.06040285696544, 0.67265041186742, -0.27724432765053, -0.49642329157145, -0.15100769254422, 0.01062120720352, 0.07675206159436, -0.06970913465857, -0.03660023640622, -0.02407617157489, 0.22723820102999, -0.32553812209094, -0.17092124706647, -0.11243449972542, 0.64589812339497, 1.00000000000000, 0.10571395437803, 0.33379906248377, 0.02484719195919, 0.13851667001100, 0.00409205344877, 0.04623547512835, 0.01981719427367, 0.19930664592091, -0.16695098771486, 0.24813774733105, -0.00489426845967, 0.34205000953698, -0.28167756670298, 0.41865482697681, -0.00825754701653, 0.00000489843911, 0.00215660918323, -0.00491424371580, 0.00231739785762, -0.00092709464380, 0.05496443214393, -0.13952072030172, 0.06579344391923, -0.02632122458134, 0.00589365702565, 0.10571395437803, 1.00000000000000, 0.64589812339497, 0.00000080172925, 0.00409199977284, 0.00011191321958, 0.02484449714789, 0.08172738229874, 0.40493318053372, -0.13134524503872, 0.19521725311514, -0.00385046473172, 0.67264977155301, -0.32836448940414, 0.48804517912417, -0.00962620219122, 0.01062078394200, 0.07674956044462, -0.07340475136150, 0.03461529858550, -0.01384814342805, 0.22723338451813, -0.34280063596865, 0.16165365523705, -0.06467091415845, 0.10571395437803, 0.33379906248377, 0.64589812339497, 1.00000000000000, 0.00409199977284, 0.04623510593782, 0.02484449714789, 0.13850753786850, 0.00000489902870, 0.00215675223531, 0.00491478595368, -0.00231742762429, 0.00092615316451, 0.05496589177315, 0.13953053232771, -0.06579165666515, 0.02629344294522, 0.01981717694273, 0.19930655336720, 0.16697346884006, -0.24812454410307, 0.00478894791561, 0.34204994390902, 0.28171558542243, -0.41863268269658, 0.00807985409285, 0.00011194644175, 0.02484719195919, 0.00000080172925, 0.00409199977284, 1.00000000000000, 0.64589812339497, 0.00589374928902, 0.10571455792685, 0.01062109909267, 0.07675142274420, 0.07340978562782, -0.03461429789822, 0.01383350280276, 0.22723697078920, 0.34282103988010, -0.16164751740794, 0.06460195702069, 0.08172736481910, 0.40493311020767, 0.13136297470605, -0.19520692980382, 0.00376760720297, 0.67264969504747, 0.32840883533420, -0.48801940279968, 0.00941905811964, 0.02484719195919, 0.13851667001100, 0.00409199977284, 0.04623510593782, 0.64589812339497, 1.00000000000000, 0.10571455792685, 0.33380021916813, 0.00000489847119, 0.00215661696654, 0.00466701315802, 0.00245032941112, 0.00161080883955, 0.05496451156223, 0.13250128760576, 0.06956736375902, 0.04573251415858, 0.01981733347759, 0.19930738932067, 0.14099384797221, 0.25241066277499, 0.07667491715452, 0.34205053666601, 0.23788241058299, 0.42586295630146, 0.12936460977760, 0.00000080175806, 0.00409205344877, 0.00011191321958, 0.02484449714789, 0.00589374928902, 0.10571455792685, 1.00000000000000, 0.64589812339497, 0.01062080108929, 0.07674966177230, 0.06971167528147, 0.03660083279331, 0.02406082412055, 0.22723357964784, 0.32555378768643, 0.17092602781714, 0.11236413980405, 0.08172752269663, 0.40493374539808, 0.11092370853691, 0.19857835779317, 0.06032225011843, 0.67265038605135, 0.27731028774901, 0.49644771407932, 0.15080617803581, 0.00409205344877, 0.04623547512835, 0.02484449714789, 0.13850753786850, 0.10571455792685, 0.33380021916813, 0.64589812339497, 1.00000000000000;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED OVERLAP: " << S << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED OVERLAP NORM: " << S.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED OVERLAP: " << Sexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED OVERLAP NORM: " << Sexp.norm() << std::endl;

    // return success or failure based on the error
    return (S - Sexp).norm() > 1e-8;
}
