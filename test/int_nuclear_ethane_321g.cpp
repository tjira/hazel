#include "../include/integral.h"

int test_int_nuclear_ethane_321g(int, char**) {
    // initialize the system
    System system("../example/molecule/ethane.xyz", "3-21G", 0, 1);

    // calculate the integral
    libint2::initialize();
    Matrix V = Integral::Nuclear(system);
    libint2::finalize();

    // create the expectation integral
    Matrix Vexp(system.shells.nbf(), system.shells.nbf()); Vexp << -38.69460632791216, -3.12404542499303, -0.05098312981908, 0.00152477591599, 0.00141575075086, -4.24108405117802, -0.00756418064225, 0.00022622543003, 0.00021004976473, -0.00000000036286, -0.03295130091058, 0.10890627621204, -0.00325709488365, -0.00302416401165, -0.84083349775467, 2.11552566046623, -0.06326970377981, -0.05874497601745, -0.00003261784140, -0.19514210260276, -0.00003261808449, -0.19514245566836, -0.00003261910883, -0.19514394319107, -0.41824571670457, -1.89434831334621, -0.41824581838528, -1.89434842264605, -0.41824696947650, -1.89434966008046, -3.12404542499303, -10.49920922347675, -0.37527169613417, 0.01122342336432, 0.01042091707627, -7.53743281369923, -0.24286758022202, 0.00726355285643, 0.00674417276009, -0.03295130104596, -0.54107300321756, 1.00910082118119, -0.03017949162112, -0.02802120759742, -2.09211350785599, 4.23012800727300, -0.12651176783402, -0.11746428252259, -0.01191555818315, -0.62078949331883, -0.01191560477464, -0.62079041204588, -0.01191580340143, -0.62079428321306, -1.76068633723991, -3.85047530181656, -1.76068646977774, -3.85047537340876, -1.76068936210257, -3.85047764001354, -0.05098312981908, -0.37527169613417, -11.11119843597973, 0.00401012173899, 0.00372325068924, -0.37335108415714, -4.81341829504716, 0.00421860847529, 0.00391685025853, -0.10890627665219, -1.00910082103510, 1.67948982781915, -0.05832947267311, -0.05415804504008, -1.77940104910869, 2.35170784012341, -0.10709939483149, -0.09944019532427, -0.02876230052804, -0.61511677166484, -0.02852248949859, -0.61003764984538, -0.02784621988776, -0.59571260630987, 0.89097529262891, 0.56389102290346, 0.77109105079250, 0.46866045071904, 0.93342530673344, 0.59761038668361, 0.00152477591599, 0.01122342336432, 0.00401012173899, -10.97723699738201, -0.00011130490182, 0.01116598319910, 0.00421860847529, -4.67249156204096, -0.00011710101012, 0.00325709503782, 0.03017951157702, -0.05832950967837, -0.26910736950013, 0.00161972184835, 0.05321715632491, -0.10709949438737, -1.22613306168917, 0.00297400104386, 0.00044546229215, 0.00961464687001, -0.01059600913610, -0.22417192587167, 0.01269679823793, 0.26901636140522, 2.00154754979715, 1.59424086394224, -2.12406192084025, -1.68295567047352, 0.04489001129925, 0.03996099191087, 0.00141575075086, 0.01042091707627, 0.00372325068924, -0.00011130490182, -10.97722060150275, 0.01036756242150, 0.00391685025853, -0.00011710101012, -4.67247426173537, 0.00302416417835, 0.02802122687026, -0.05415808086536, 0.00161972189221, -0.26934795917546, 0.04941134853238, -0.09944031971315, 0.00297400199948, -1.22657482865200, -0.01266044249131, -0.26789717631763, 0.00787111672644, 0.16682947903915, 0.00715346821120, 0.15163220496946, -1.27802969041991, -1.01121389687587, -1.15202842433576, -0.91112413973046, 2.35798844050042, 1.87707137002326, -4.24108405117802, -7.53743281369923, -0.37335108415714, 0.01116598319910, 0.01036756242150, -8.37179908912255, -0.72479821576687, 0.02167688116993, 0.02012672764585, -0.84083350158787, -2.09211351897922, 1.77940105538462, -0.05321701448877, -0.04941120050107, -3.79042520513287, 4.87030520436918, -0.14565761647569, -0.13524091602954, -0.35526277116564, -1.62291551294179, -0.35526335399416, -1.62291706477400, -0.35526589092411, -1.62292368652849, -2.56263415594269, -5.03624322166018, -2.56263410034908, -5.03624302614176, -2.56263639636439, -5.03624549520880, -0.00756418064225, -0.24286758022202, -4.81341829504716, 0.00421860847529, 0.00391685025853, -0.72479821576687, -7.21463933330769, 0.01991607261983, 0.01849170308906, -2.11552567014059, -4.23012803190964, 2.35170784475295, -0.10709920528060, -0.09944000408595, -4.87030521003177, 2.50117331209913, -0.16338338942078, -0.15169902483312, -0.93656094418826, -2.54239785379616, -0.92859885400923, -2.52342875801273, -0.90614293371312, -2.46992740071953, 1.23045861179483, 0.95296825288894, 1.06527758441657, 0.78438818248169, 1.28894642656264, 1.01265900843690, 0.00022622543003, 0.00726355285643, 0.00421860847529, -4.67249156204096, -0.00011710101012, 0.02167688116993, 0.01991607261983, -6.54931664956218, -0.00055296319157, 0.06326970618878, 0.12651186288384, -0.10709947069668, -1.22613309515929, 0.00297396359739, 0.14565794165761, -0.16338380702839, -2.95693941214073, 0.00453690389839, 0.01424376073429, 0.04324070496940, -0.35225071635816, -0.82983638851224, 0.42089231828840, 1.01197461658842, 2.75772070549700, 2.82352908438210, -2.92669494702909, -2.97786758526255, 0.06176601232417, 0.07209302045059, 0.00021004976473, 0.00674417276009, 0.00391685025853, -0.00011710101012, -4.67247426173537, 0.02012672764585, 0.01849170308906, -0.00055296319157, -6.54923456957044, 0.05874497884149, 0.11746438071119, -0.09944026055484, 0.00297396389748, -1.22657482138520, 0.13524123573633, -0.15169943542131, 0.00453690458165, -2.95761330229579, -0.42073662968399, -0.99365343984111, 0.26075862105585, 0.62983500739698, 0.23693586410578, 0.57307989371697, -1.76099496576240, -1.78882591072248, -1.58738576078484, -1.61164458648944, 3.24884063085813, 3.32410677593755, -0.00000000036286, -0.03295130104596, -0.10890627665219, 0.00325709503782, 0.00302416417835, -0.84083350158787, -2.11552567014059, 0.06326970618878, 0.05874497884149, -38.69460644267416, -3.12404544696393, 0.05098312553096, -0.00152471011127, -0.00141566700828, -4.24108407187123, 0.00756418000604, -0.00022621566682, -0.00021003734015, -0.41824536322774, -1.89434794023438, -0.41824564351015, -1.89434824162248, -0.41824813418897, -1.89435091922180, -0.00003261841183, -0.19514293176924, -0.00003261811558, -0.19514250162949, -0.00003261850687, -0.19514306957907, -0.03295130091058, -0.54107300321756, -1.00910082103510, 0.03017951157702, 0.02802122687026, -2.09211351897922, -4.23012803190964, 0.12651186288384, 0.11746438071119, -3.12404544696393, -10.49920933744422, 0.37527166506342, -0.01122294774351, -0.01042031173608, -7.53743289672220, 0.24286756214379, -0.00726327870408, -0.00674382393271, -1.76068528721514, -3.85047445145317, -1.76068606638597, -3.85047509206437, -1.76069236174353, -3.85048004870217, -0.01191566672481, -0.62079164664203, -0.01191561071198, -0.62079051617672, -0.01191568738950, -0.62079202455551, 0.10890627621204, 1.00910082118119, 1.67948982781915, -0.05832950967837, -0.05415808086536, 1.77940105538462, 2.35170784475295, -0.10709947069668, -0.09944026055484, 0.05098312553096, 0.37527166506342, -11.11119856675260, 0.00400992054120, 0.00372317141987, 0.37335105605313, -4.81341836770827, 0.00421841873322, 0.00391675965560, -0.93344677905529, -0.59762887615604, -0.89095232252047, -0.56387293085792, -0.77109318754136, -0.46866040745580, 0.02852276518381, 0.61004161455799, 0.02784577704142, 0.59570907411000, 0.02876247544780, 0.61511640340695, -0.00325709488365, -0.03017949162112, -0.05832947267311, -0.26910736950013, 0.00161972189221, -0.05321701448877, -0.10709920528060, -1.22613309515929, 0.00297396389748, -0.00152471011127, -0.01122294774351, 0.00400992054120, -10.97723720725901, -0.00011146534059, -0.01116555651518, 0.00421841873322, -4.67249166657185, -0.00011721747154, -0.04554153620891, -0.04047845484300, -2.00120271859387, -1.59396694886247, 2.12437810213667, 1.68320301736400, 0.01059801428941, 0.22421399764857, -0.01269484495426, -0.26897742596113, -0.00044915231766, -0.00969327760199, -0.00302416401165, -0.02802120759742, -0.05415804504008, 0.00161972184835, -0.26934795917546, -0.04941120050107, -0.09944000408595, 0.00297396359739, -1.22657482138520, -0.00141566700828, -0.01042031173608, 0.00372317141987, -0.00011146534059, -10.97722059912368, -0.01036701950655, 0.00391675965560, -0.00011721747154, -4.67247424108423, -2.35796221312601, -1.87705338697535, 1.27858485294125, 1.01165518756628, 1.15145934666838, 0.91067015206342, -0.00786801723789, -0.16676275048550, -0.00715659306184, -0.15170040819923, 0.01266069722664, 0.26790078740228, -0.84083349775467, -2.09211350785599, -1.77940104910869, 0.05321715632491, 0.04941134853238, -3.79042520513287, -4.87030521003177, 0.14565794165761, 0.13524123573633, -4.24108407187123, -7.53743289672220, 0.37335105605313, -0.01116555651518, -0.01036701950655, -8.37179916390965, 0.72479818719843, -0.02167643086509, -0.02012616536177, -2.56263312068769, -5.03624194639933, -2.56263382353267, -5.03624278101776, -2.56263885198397, -5.03624822761463, -0.35526410372755, -1.62291910225275, -0.35526343129133, -1.62291722949898, -0.35526442297731, -1.62291985101469, 2.11552566046623, 4.23012800727300, 2.35170784012341, -0.10709949438737, -0.09944031971315, 4.87030520436918, 2.50117331209913, -0.16338380702839, -0.15169943542131, 0.00756418000604, 0.24286756214379, -4.81341836770827, 0.00421841873322, 0.00391675965560, 0.72479818719843, -7.21463944068382, 0.01991556003047, 0.01849136244200, -1.28897770854973, -1.01269231712809, -1.23042700182954, -0.95293631412723, -1.06527850979718, -0.78438735177519, 0.92860509381907, 2.52344194970153, 0.90613679071721, 2.46991850395876, 0.93656082985915, 2.54239351193478, -0.06326970377981, -0.12651176783402, -0.10709939483149, -1.22613306168917, 0.00297400199948, -0.14565761647569, -0.16338338942078, -2.95693941214073, 0.00453690458165, -0.00022621566682, -0.00726327870408, 0.00421841873322, -4.67249166657185, -0.00011721747154, -0.02167643086509, 0.01991556003047, -6.54931662850174, -0.00055306812794, -0.06266396701758, -0.07301011477712, -2.75724559384673, -2.82304371668196, 2.92712518593823, 2.97830483946736, 0.35231608653824, 0.82999258230861, -0.42083153818276, -1.01183166119987, -0.01436601801761, -0.04353388116386, -0.05874497601745, -0.11746428252259, -0.09944019532427, 0.00297400104386, -1.22657482865200, -0.13524091602954, -0.15169902483312, 0.00453690389839, -2.95761330229579, -0.00021003734015, -0.00674382393271, 0.00391675965560, -0.00011721747154, -4.67247424108423, -0.02012616536177, 0.01849136244200, -0.00055306812794, -6.54923460200133, -3.24880872384002, -3.32407575935641, 1.76176007591949, 1.78960771626302, 1.58659852893894, 1.61083942974605, -0.26065504668209, -0.62958581532160, -0.23704170774294, -0.57333543367434, 0.42074240847867, 0.99366538184117, -0.00003261784140, -0.01191555818315, -0.02876230052804, 0.00044546229215, -0.01266044249131, -0.35526277116564, -0.93656094418826, 0.01424376073429, -0.42073662968399, -0.41824536322774, -1.76068528721514, -0.93344677905529, -0.04554153620891, -2.35796221312601, -2.56263312068769, -1.28897770854973, -0.06266396701758, -3.24880872384002, -7.29809002290763, -4.37884465876375, -0.07440237104331, -0.91644342213803, -0.07440256039869, -0.91644411135257, -0.00052282884985, -0.15510076647345, -0.00052354147053, -0.15517581811714, -0.00000764892290, -0.03457115703250, -0.19514210260276, -0.62078949331883, -0.61511677166484, 0.00961464687001, -0.26789717631763, -1.62291551294179, -2.54239785379616, 0.04324070496940, -0.99365343984111, -1.89434794023438, -3.85047445145317, -0.59762887615604, -0.04047845484300, -1.87705338697535, -5.03624194639933, -1.01269231712809, -0.07301011477712, -3.32407575935641, -4.37884465876375, -6.02652427642667, -0.91644346453847, -2.56164267569658, -0.91644487556478, -2.56164467664568, -0.15510076858466, -0.87703339733620, -0.15517582610799, -0.87726639297961, -0.03457116382657, -0.38829645841129, -0.00003261808449, -0.01191560477464, -0.02852248949859, -0.01059600913610, 0.00787111672644, -0.35526335399416, -0.92859885400923, -0.35225071635816, 0.26075862105585, -0.41824564351015, -1.76068606638597, -0.89095232252047, -2.00120271859387, 1.27858485294125, -2.56263382353267, -1.23042700182954, -2.75724559384673, 1.76176007591949, -0.07440237104331, -0.91644346453847, -7.29809101973441, -4.37884529624901, -0.07440280967646, -0.91644540389289, -0.00000764893259, -0.03457117500779, -0.00052282619186, -0.15510048932774, -0.00052355043896, -0.15517678675479, -0.19514245566836, -0.62079041204588, -0.61003764984538, -0.22417192587167, 0.16682947903915, -1.62291706477400, -2.52342875801273, -0.82983638851224, 0.62983500739698, -1.89434824162248, -3.85047509206437, -0.56387293085792, -1.59396694886247, 1.01165518756628, -5.03624278101776, -0.95293631412723, -2.82304371668196, 1.78960771626302, -0.91644342213803, -2.56164267569658, -4.37884529624901, -6.02652515144918, -0.91644593870014, -2.56164657546165, -0.03457117030912, -0.38829656767286, -0.15510049169453, -0.87703250127434, -0.15517681584809, -0.87726968421843, -0.00003261910883, -0.01191580340143, -0.02784621988776, 0.01269679823793, 0.00715346821120, -0.35526589092411, -0.90614293371312, 0.42089231828840, 0.23693586410578, -0.41824813418897, -1.76069236174353, -0.77109318754136, 2.12437810213667, 1.15145934666838, -2.56263885198397, -1.06527850979718, 2.92712518593823, 1.58659852893894, -0.07440256039869, -0.91644487556478, -0.07440280967646, -0.91644593870014, -7.29809625501297, -4.37884862067647, -0.00052355851759, -0.15517771821249, -0.00000764905349, -0.03457138252643, -0.00052284292007, -0.15510234465164, -0.19514394319107, -0.62079428321306, -0.59571260630987, 0.26901636140522, 0.15163220496946, -1.62292368652849, -2.46992740071953, 1.01197461658842, 0.57307989371697, -1.89435091922180, -3.85048004870217, -0.46866040745580, 1.68320301736400, 0.91067015206342, -5.03624822761463, -0.78438735177519, 2.97830483946736, 1.61083942974605, -0.91644411135257, -2.56164467664568, -0.91644540389289, -2.56164657546165, -4.37884862067647, -6.02652935133886, -0.15517766170593, -0.87727276319541, -0.03457137321089, -0.38829793122383, -0.15510232075806, -0.87703874279996, -0.41824571670457, -1.76068633723991, 0.89097529262891, 2.00154754979715, -1.27802969041991, -2.56263415594269, 1.23045861179483, 2.75772070549700, -1.76099496576240, -0.00003261841183, -0.01191566672481, 0.02852276518381, 0.01059801428941, -0.00786801723789, -0.35526410372755, 0.92860509381907, 0.35231608653824, -0.26065504668209, -0.00052282884985, -0.15510076858466, -0.00000764893259, -0.03457117030912, -0.00052355851759, -0.15517766170593, -7.29809175021855, -4.37884576641642, -0.07440245856952, -0.91644390772907, -0.07440237401084, -0.91644353187674, -1.89434831334621, -3.85047530181656, 0.56389102290346, 1.59424086394224, -1.01121389687587, -5.03624322166018, 0.95296825288894, 2.82352908438210, -1.78882591072248, -0.19514293176924, -0.62079164664203, 0.61004161455799, 0.22421399764857, -0.16676275048550, -1.62291910225275, 2.52344194970153, 0.82999258230861, -0.62958581532160, -0.15510076647345, -0.87703339733620, -0.03457117500779, -0.38829656767286, -0.15517771821249, -0.87727276319541, -4.37884576641642, -6.02652585572176, -0.91644392382779, -2.56164357426615, -0.91644369138918, -2.56164328089419, -0.41824581838528, -1.76068646977774, 0.77109105079250, -2.12406192084025, -1.15202842433576, -2.56263410034908, 1.06527758441657, -2.92669494702909, -1.58738576078484, -0.00003261811558, -0.01191561071198, 0.02784577704142, -0.01269484495426, -0.00715659306184, -0.35526343129133, 0.90613679071721, -0.42083153818276, -0.23704170774294, -0.00052354147053, -0.15517582610799, -0.00052282619186, -0.15510049169453, -0.00000764905349, -0.03457137321089, -0.07440245856952, -0.91644392382779, -7.29809115547242, -4.37884537984955, -0.07440267458289, -0.91644479105080, -1.89434842264605, -3.85047537340876, 0.46866045071904, -1.68295567047352, -0.91112413973046, -5.03624302614176, 0.78438818248169, -2.97786758526255, -1.61164458648944, -0.19514250162949, -0.62079051617672, 0.59570907411000, -0.26897742596113, -0.15170040819923, -1.62291722949898, 2.46991850395876, -1.01183166119987, -0.57333543367434, -0.15517581811714, -0.87726639297961, -0.15510048932774, -0.87703250127434, -0.03457138252643, -0.38829793122383, -0.91644390772907, -2.56164357426615, -4.37884537984955, -6.02652521489398, -0.91644512146977, -2.56164525601665, -0.41824696947650, -1.76068936210257, 0.93342530673344, 0.04489001129925, 2.35798844050042, -2.56263639636439, 1.28894642656264, 0.06176601232417, 3.24884063085813, -0.00003261850687, -0.01191568738950, 0.02876247544780, -0.00044915231766, 0.01266069722664, -0.35526442297731, 0.93656082985915, -0.01436601801761, 0.42074240847867, -0.00000764892290, -0.03457116382657, -0.00052355043896, -0.15517681584809, -0.00052284292007, -0.15510232075806, -0.07440237401084, -0.91644369138918, -0.07440267458289, -0.91644512146977, -7.29809350017678, -4.37884686791836, -1.89434966008046, -3.85047764001354, 0.59761038668361, 0.03996099191087, 1.87707137002326, -5.03624549520880, 1.01265900843690, 0.07209302045059, 3.32410677593755, -0.19514306957907, -0.62079202455551, 0.61511640340695, -0.00969327760199, 0.26790078740228, -1.62291985101469, 2.54239351193478, -0.04353388116386, 0.99366538184117, -0.03457115703250, -0.38829645841129, -0.15517678675479, -0.87726968421843, -0.15510234465164, -0.87703874279996, -0.91644353187674, -2.56164328089419, -0.91644479105080, -2.56164525601665, -4.37884686791836, -6.02652708511539;

    // print the results
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED NUCLEAR: " << V << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "COMPUTED NUCLEAR NORM: " << V.norm() << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED NUCLEAR: " << Vexp << std::endl;
    std::cout << std::fixed << std::setprecision(14) << "EXPECTED NUCLEAR NORM: " << Vexp.norm() << std::endl;

    // return success or failure based on the error
    return (V - Vexp).norm() > 1e-8;
}
